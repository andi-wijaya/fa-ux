$.fn.extend({autocomplete:function(j){var f=$.val("class",j,{d:""});var c=$.val("name",j,{d:""});var b=$.val("src",j,{d:""});var i=$.val("value",j,{d:""});var d=$.val("width",j);var a=$.val("method",j,{d:"get"});var h=$.val("placeholder",j,{d:""});var g=$.val("onbeforehint",j,{d:null});var e={};if(d!=null){e.width=d}this.each(function(){var l=this;var k=[];k.push("<input type='text' placeholder=\""+h+'"/>');k.push("<span class='icon fa fa-search hoverable selectable'></span>");k.push("<span class='popup'></span>");$(l).addClass("autocomplete");$(l).addClass(f);$(l).html(k.join(""));$(l).css(e);$(l).attr("data-name",c);$(l).attr("data-type","autocomplete");$(l).data("options",j);$("input[type='text']",l).on("keyup",function(r){var o=$(this).closest(".autocomplete");if($(o).hasClass("readonly")){return}var n=$(o).data("options");var q=$.val("map",n,{d:null});var m=$.val("readonly",n);if(!m&&b.length>0){var s={};s.key=this.value;var p=$.fire_event(g,[this.value],o);if(typeof p!="undefined"||p!=null){s.custom=p}if(a=="post"){$.api_post(b,s,function(t){var w=$.val("data",t);var y=[];if($.type(w)=="array"){for(var x=0;x<w.length;x++){var C=w[x];var u=$.val("value",q,{d:"value"});var z=$.val("text",q,{d:"text"});var A=$.val(u,C,{d:""});var B=$.val(z,C,{d:A});y.push("<div class='item' data-value=\""+A+'">');y.push("<label>"+B+"</label>");y.push("</div>")}}$(".popup",o).html(y.join(""));$(".item",$(".popup",o)).on("click",function(){var D=this.getAttribute("data-value");var F=$("label",this).text();var E={value:D,text:F};$(o).autocomplete_val(E,true);$(o).autocomplete_validate()});$.popup_open($(".popup",o),o,{min_width:$(o).outerWidth()})})}else{$.api_get(b,s,function(t){var w=$.val("data",t);var y=[];if($.type(w)=="array"){for(var x=0;x<w.length;x++){var C=w[x];var u=$.val("value",q,{d:"value"});var z=$.val("text",q,{d:"text"});var A=$.val(u,C,{d:""});var B=$.val(z,C,{d:A});y.push("<div class='item' data-value=\""+A+'">');y.push("<label>"+B+"</label>");y.push("</div>")}}$(".popup",o).html(y.join(""));$(".item",$(".popup",o)).on("click",function(){var D=this.getAttribute("data-value");var F=$("label",this).text();var E={value:D,text:F};$(o).autocomplete_val(E,true)});$.popup_open($(".popup",o),o,{min_width:$(o).outerWidth()})})}}});$(l).on("click",function(m){$("input",this).select()});$("input[type='text']",l).on("blur",function(m){$(this).closest(".autocomplete").autocomplete_validate()});if(i.length>0){$(this).autocomplete_val(i)}})},autocomplete_val:function(c,a){if(typeof c=="undefined"){var b=[];$(this).each(function(){var f=$(this).data("options");var d=$.val("multiple",f,{d:false});if(d){$(".text",this).each(function(){b.push(this.getAttribute("data-value"))})}else{var g=$("input",this).val();var e=$(this).data("value");if(e==null){e=g}b.push(e)}});return b.join(",")}else{$(this).each(function(){var j=$(this).data("options");var f=$.val("multiple",j,{d:false});var l=b="";if($.type(c)=="object"){b=$.val("value",c,{d:""});l=$.val("text",c,{d:b})}else{l=b=c}if(f){var e=typeof a!="undefined"&&a===true?true:false;if(!e==true){$(".text",this).remove()}var d=$(this).val();d=d.split(",");b=b.split(",");l=l.split(",");for(var k=0;k<b.length;k++){var h=b[k];var g=typeof l[k]!="undefined"?l[k]:h;if(!$.in_array(h.toLowerCase(),d)&&h!==""){$("<span class='text' data-value=\""+h+'">'+g+"<span class='icon-remove glyphicons glyphicons-remove'></span></span>").insertBefore($("input",this));$(".glyphicons-remove",$("input",this).prev()).on("click",function(){$(this).parent().remove()})}}$("input",this).val("")}else{$("input",this).val(l);$(this).data("value",b)}})}},autocomplete_readonly:function(a){if(typeof a=="undefined"){return $(this).hasClass("readonly")?true:false}else{if(a){$(this).addClass("readonly");$("input",this).attr("readonly",true);$("input",this).data("placeholder",$("input",this).attr("placeholder"));$("input",this).attr("placeholder","")}else{$(this).removeClass("readonly");$("input",this).attr("readonly",false);$("input",this).attr("placeholder",$("input",this).data("placeholder"))}}},autocomplete_reset:function(){$(this).autocomplete_val("",true)},autocomplete_validate:function(){return $(this).element_validate()}});$.fn.extend({button_state:function(b,a){var a=typeof a=="undefined"&&(a!=true||parseInt(a)!=1)?false:true;if(typeof b=="undefined"){return $(this).attr("disabled")?2:1}else{$(this).each(function(){switch(parseInt(b)){case 1:var c=$(this).data("html");if(c!=null){$(this).html(c)}$(this).attr("disabled",false);break;case 2:$(this).css({width:$(this).outerWidth(),height:$(this).outerHeight()});if(a){$(this).data("html",$(this).html()).html('<span class="spinner loading width16 height16"></span>')}$(this).attr("disabled",true);break}})}}});$.fn.extend({calendar:function(a){this.each(function(){var c=this;var d=$.val("value",a,{d:"2017-01-01"});d=$.date("j M Y",$.strtotime(d));var b=[];b.push("<input type='text' value='"+d+"' readonly/>");b.push("<span class='icon fa fa-calendar'></span>");b.push("<span class='popup'>Calendar</span>");$(c).addClass("calendar");$(c).html(b.join(""));$(c).attr("data-type","calendar");$(".icon",this).click(function(f){f.preventDefault();f.stopPropagation()});$(".popup",this).click(function(f){f.preventDefault();f.stopPropagation()})})}});$.extend({calendar_open:function(d){var b=d.refEl;var c=d.value;var a=$("#calendar");if(a.length==0){a=document.createElement("div");a.id="calendar";a.className="popup";document.body.appendChild(a);a=$("#calendar")}a=a[0];$(a).data("params",d);$.calendar_set(c,d);$.popup_open(a,b)},calendar_set:function(a,c){var b=$.val("mode",c,{d:""});switch(b){case"range":$.calendar_set_range(a);break;default:$.calendar_set_single(a);break}},calendar_set_single:function(n){var a=$("#calendar");$(a).attr("data-value",n);var l=$.date("n",$.strtotime(n));var m=$.date("Y",$.strtotime(n));var c=$.date("j",$.strtotime(n));var k=$.start_day_of_month(m,l)%7;var o=$.last_date_of_month(m,l);var p=$.date("M Y",$.strtotime(n));var e=$(a).data("params");var d=e.onchange;var h=[];h.push("<table>");h.push("<tr>");h.push("<td><span class='calendar-prev fa fa-caret-left padding5'></span></td>");h.push("<td colspan='5'><span class='date-label'>"+p+"</span></td>");h.push("<td><span class='calendar-next fa fa-caret-right padding5'></span></td>");h.push("</tr>");h.push("<tr>");h.push("<td>Sun</td>");h.push("<td>Mon</td>");h.push("<td>Tue</td>");h.push("<td>Wed</td>");h.push("<td>Thu</td>");h.push("<td>Fri</td>");h.push("<td>Sun</td>");h.push("</tr>");var b=1;for(var g=0;g<6;g++){h.push("<tr>");for(var f=0;f<7;f++){if(k>0){h.push("<td></td>");k--}else{if(b<=o){h.push(b==c?"<td class='day active'>"+b+"</td>":"<td class='day'>"+b+"</td>");b++}else{h.push("<td></td>")}}}h.push("</tr>")}h.push("</table>");a.html(h.join(""));$(".day",a).click(function(t){t.preventDefault();t.stopPropagation();var i=$(this).closest("#calendar");var q=$(i).attr("data-value");var j=this.innerHTML;var s=parseInt($.date("n",$.strtotime(q)));var r=$.date("Y",$.strtotime(q));var u=$.date("Ymd",$.mktime(0,0,0,s,j,r));$.fire_event(d,[u],i);$.popup_close(i)});$(".calendar-prev",a).click(function(s){s.preventDefault();s.stopPropagation();var i=$(this).closest("#calendar");var j=$(i).attr("data-value");var r=parseInt($.date("n",$.strtotime(j)));var q=parseInt($.date("Y",$.strtotime(j)));var u=parseInt($("td.active",i).html());var t=$.date("Y-m-d",$.mktime(0,0,0,r-1,u,q));$.calendar_set(t)});$(".calendar-next",a).click(function(s){s.preventDefault();s.stopPropagation();var i=$(this).closest("#calendar");var j=$(i).attr("data-value");var r=parseInt($.date("n",$.strtotime(j)));var q=parseInt($.date("Y",$.strtotime(j)));var u=parseInt($("td.active",i).html());var t=$.date("Y-m-d",$.mktime(0,0,0,r+1,u,q));$.calendar_set(t)})},calendar_set_range:function(l,u,e){var b=$("#calendar");$(b).attr("data-value",l);var y=$(b).data("params");var x=y.onchange;l=l.split("-");var a=l[0];var A=l[1];if($.date("Y",$.strtotime(a))=="1970"){a=$.date("Y-m-d")}if($.date("Y",$.strtotime(A))=="1970"){A=$.date("Y-m-d")}var w=[],m=[],r=[],d=[],t=[],c=[],h=[];var p=$.date("Y",$.strtotime(u))!="1970"?u:a;var n=$.date("Y",$.strtotime(e))!="1970"?e:A;if($.date("Ym",$.strtotime(n))==$.date("Ym",$.strtotime(p))){n=$.date("Y-m-d",$.mktime(0,0,0,parseInt($.date("n",$.strtotime(n)))+1,$.date("j",1,$.date("Y",$.strtotime(n)))))}w[0]=$.date("n",$.strtotime(p));m[0]=$.date("m",$.strtotime(p));r[0]=$.date("Y",$.strtotime(p));d[0]=$.date("j",$.strtotime(p));t[0]=$.start_day_of_month(r[0],w[0])%7;c[0]=$.last_date_of_month(r[0],w[0]);h[0]=$.date("M Y",$.strtotime(p));w[1]=$.date("n",$.strtotime(n));m[1]=$.date("m",$.strtotime(n));r[1]=$.date("Y",$.strtotime(n));d[1]=$.date("j",$.strtotime(n));t[1]=$.start_day_of_month(r[1],w[1])%7;c[1]=$.last_date_of_month(r[1],w[1]);h[1]=$.date("M Y",$.strtotime(n));var g=[];for(var s=0;s<2;s++){g.push("<table class='calendar-table range-"+s+"'>");g.push("<tr>");g.push($.p("<td><span class='calendar-prev fa fa-caret-left padding5' data-calendaridx='$i'></span></td>",[s]));g.push("<td colspan='5'><span class='date-label'>"+h[s]+"</span></td>");g.push($.p("<td><span class='calendar-next fa fa-caret-right padding5' data-calendaridx='$i'></span></td>",[s]));g.push("</tr>");g.push("<tr>");g.push("<td>Sun</td>");g.push("<td>Mon</td>");g.push("<td>Tue</td>");g.push("<td>Wed</td>");g.push("<td>Thu</td>");g.push("<td>Fri</td>");g.push("<td>Sun</td>");g.push("</tr>");var z=1;for(var q=0;q<6;q++){g.push("<tr>");for(var o=0;o<7;o++){if(t[s]>0){g.push("<td></td>");t[s]--}else{if(z<=c[s]){var f=$.date("Y-m-d",$.strtotime(r[s]+"-"+m[s]+"-"+$.str_pad(z,2,"0","STR_PAD_LEFT")));if($.strtotime(f)>=$.strtotime(a)&&$.strtotime(f)<=$.strtotime(A)){g.push("<td class='day active' data-date='"+f+"'>"+z+"</td>")}else{g.push("<td class='day' data-date='"+f+"'>"+z+"</td>")}z++}else{g.push("<td></td>")}}}g.push("</tr>")}g.push("</table>")}b.html(g.join(""));b.data("seq",0);$(".day",b).click(function(B){B.preventDefault();B.stopPropagation();var i=$(this).closest("#calendar");var k=$(i).attr("data-value");var j=this.innerHTML;var C=parseInt($.date("n",$.strtotime(k)));var E=$.date("Y",$.strtotime(k));var D=$.date("j M Y",$.mktime(0,0,0,C,j,E));var I=parseInt(i.data("seq"));if(I==0){$(".day.active-0").removeClass("active active-0");$(this).addClass("active active-0");var J=$(this).attr("data-date");var F=$(i).attr("data-value");F=F.split(",");var H=$.val(1,F,{d:J});$(".day",i).each(function(){var K=$(this).attr("data-date");if($.strtotime(K)>=$.strtotime(J)&&$.strtotime(K)<=$.strtotime(H)){$(this).addClass("active")}else{$(this).removeClass("active")}})}else{$(".day.active-1").removeClass("active active-1");$(this).addClass("active active-1")}i.data("seq",I+1);if(I==1){var J=$(".day.active-0").attr("data-date");var H=$(".day.active-1").attr("data-date");if($.strtotime(J)>$.strtotime(H)){var G=J;J=H;H=G}var F=$.date("Ymd",$.strtotime(J))+"-"+$.date("Ymd",$.strtotime(H));$.popup_close(i);$.fire_event(x,[F],i)}});$(".calendar-prev",b).click(function(j){var i=parseInt($(this).attr("data-calendaridx"));console.log(["prev",l,parseInt($(this).attr("data-calendaridx")),p,n]);j.preventDefault();j.stopPropagation();if(i==0){p=$.date("Y-m-d",$.mktime(0,0,0,parseInt($.date("n",$.strtotime(p)))-1,$.date("j",$.strtotime(p)),$.date("Y",$.strtotime(p))))}else{if(i==1){n=$.date("Y-m-d",$.mktime(0,0,0,parseInt($.date("n",$.strtotime(n)))-1,$.date("j",$.strtotime(n)),$.date("Y",$.strtotime(n))));if($.date("Ym",$.strtotime(p))>=$.date("Ym",$.strtotime(n))){p=$.date("Y-m-d",$.mktime(0,0,0,parseInt($.date("n",$.strtotime(p)))-1,$.date("j",$.strtotime(p)),$.date("Y",$.strtotime(p))))}}}$.calendar_set_range(l.join(","),p,n)});$(".calendar-next",b).click(function(j){var i=parseInt($(this).attr("data-calendaridx"));j.preventDefault();j.stopPropagation();if(i==0){p=$.date("Y-m-d",$.mktime(0,0,0,parseInt($.date("n",$.strtotime(p)))+1,$.date("j",$.strtotime(p)),$.date("Y",$.strtotime(p))));if($.date("Ym",$.strtotime(n))<=$.date("Ym",$.strtotime(p))){n=$.date("Y-m-d",$.mktime(0,0,0,parseInt($.date("n",$.strtotime(n)))+1,$.date("j",$.strtotime(n)),$.date("Y",$.strtotime(n))))}}else{if(i==1){n=$.date("Y-m-d",$.mktime(0,0,0,parseInt($.date("n",$.strtotime(n)))+1,$.date("j",$.strtotime(n)),$.date("Y",$.strtotime(n))))}}$.calendar_set_range(l.join(","),p,n)})}});$.fn.extend({chart:function(c){var b=$.val("name",c);var a=$.val("height",c);var d=$.val("width",c);this.each(function(){var g=this;var f={};f.height=a;f.width=d;var e=[];$(g).addClass("chart");$(this).html(e.join(""));$(this).css(f);$(g).attr("data-type","chart");$(g).attr("data-name",b);$(g).data("options",c)})},chart_set:function(a){this.each(function(){var d=this;var b=$(d).data("options");var c=$.val("type",b,{default_value:"line"});switch(c){case"bar":$(this).chart_bar_set(a);break;default:$(this).chart_line_set(a);break}})},chart_bar_set:function(a){this.each(function(){var b=this;var f=$(b).data("options");var t=$(b).outerHeight();var z=$(b).outerWidth();var s=$.val("padding",f,{default_value:10});var A=$.array_key_count(a);var i=$.object_value_min(a);var r=$.object_value_max(a);var u=s;var k=z-s;var E=k-u;var q=(z*0.8)/A;var g=(E-(q*A))/(A+1);var H=t-s;var I=10;var c=H-I;var j=c/(r-i);var p=[];p.push($.p('<svg width="$1" height="$2">',[z,t]));var D=u;var C=k;var e=H,d=H;p.push($.p('<line x1="$x1" y1="$y1" x2="$x2" y2="$y2" style="stroke:rgb(0,0,0);stroke-width:1" />',[D,e,C,d]));var m=0;for(var G in a){var F=a[G];var o=q;var B=j*F;if(B<5){B=5}var n=m*(g+q)+g;var l=H-B;p.push($.p('<rect x="$1" y="$1" width="$1" height="$1" stroke="#4A89DC" stroke-width="2" fill="rgba(74, 137, 220, .2)" data-key="$1" data-value="$1" onmouseover="$1" onmouseout="$1"/>',[n,l,o,B,G,F,"$.chart_line_mouseover.call(this)","$.chart_line_mouseout.call(this)"]));m++}p.push("</svg>");$(b).html(p.join(""))})},chart_line_set:function(a){this.each(function(){var b=this;var i=$(b).data("options");var q=$(b).outerHeight();var s=$(b).outerWidth();var t=$.array_key_count(a);var j=$.object_value_min(a);var o=$.object_value_max(a);var p=$.val("padding",i,{default_value:10});var r=p;var l=s-p;var y=l-r;var z=y/(t-1);var C=q-p;var D=10;var c=C-D;var k=c/(o-j);var n=[];n.push($.p('<svg width="$1" height="$2">',[s,q]));var w=r;var u=l;var h=C,f=C;n.push($.p('<line x1="$x1" y1="$y1" x2="$x2" y2="$y2" style="stroke:rgb(0,0,0);stroke-width:1" />',[w,h,u,f]));var m=1;for(var B in a){var g=Math.round(r+(m*z));n.push($.p('<line x1="$1" y1="$1" x2="$1" y2="$1" style="stroke:rgba(0, 0, 0, .05);stroke-width:1" />',[g,C,g,D]));m++}var m=0;var x=[];x.push($.p("M$1 $2",[Math.round(r+(m*z)),C]));for(var B in a){var A=a[B];var g=Math.round(r+(m*z));var e=Math.round(C-(A*k));x.push($.p("L$1 $2",[g,e]));m++}x.push($.p("M$1 $2 Z",[g,C]));n.push($.p('<path d="$1" stroke-width="0" stroke="transparent" fill="rgba(74, 137, 220, .2)"/>',[x.join(" ")]));var m=0;var x=[];for(var B in a){var A=a[B];var g=Math.round(r+(m*z));var e=Math.round(C-(A*k));if(m==0){x.push($.p("M$1 $2",[g,e]))}else{x.push($.p("L$1 $2",[g,e]))}m++}n.push($.p('<path d="$1" stroke-width="2" stroke="#4A89DC" fill="transparent"/>',[x.join(" ")]));var m=0;for(var B in a){var A=a[B];var g=r+(m*z);var e=C-(A*k);n.push($.p('<circle cx="$1" cy="$1" r="1" stroke="#4A89DC" stroke-width="2" fill="#4A89DC" onmouseover="$1" onmouseout="$1" data-key="$1" data-value="$1"/>',[g,e,"$.chart_line_mouseover.call(this)","$.chart_line_mouseout.call(this)",B,A]));m++}n.push("</svg>");$(b).html(n.join(""))})}});$.extend({chart_line_mouseover:function(){$(this).attr({r:2});var a=$(this).attr("data-key");var b=$(this).attr("data-value");$.tooltip(this,a+"<br />"+b)},chart_line_mouseout:function(){$(this).attr({r:1});$.tooltip_remove()}});$.fn.extend({checkbox:function(a){this.each(function(){var f=$.val("class",a,{d:""});var b=$.val("items",a,{d:null});var c=$.val("name",a,{d:""});var e=[];if($.type(b)=="array"){$(b).each(function(){var k=$.val("text",this,{d:""});var j=$.val("value",this,{d:""});var i="checkbox-"+$.uniqid();e.push("<span class='item'><input id='"+i+"' type='checkbox' value=\""+j+"\"/><label for='"+i+"'>"+k+"</label></span>")})}else{var h=$.val("text",a,{d:""});var g="";var d="checkbox-"+$.uniqid();e.push("<span class='item'><input id='"+d+"' type='checkbox' value=\""+g+"\"/><label for='"+d+"'>"+h+"</label></span>")}$(this).addClass("checkbox");$(this).addClass(f);$(this).attr("data-type","checkbox");$(this).attr("data-name",c);$(this).html(e.join(""));$(this).data("options",a);$(this).checkbox_val($.val("value",a,{d:false}))})},checkbox_val:function(b){if(typeof b=="undefined"){var a=[];$(this).each(function(){if(!$(this).hasClass("checkbox")){return}var e=$(this).data("options");var c=$.val("items",e,{d:null});var d=$.type(c)=="array"?true:false;if(d){$(".item",this).each(function(){if($("input[type=checkbox]",this).is(":checked")){a.push($("input[type=checkbox]",this).val())}})}else{a.push($("input[type=checkbox]",this).is(":checked")?1:0)}});return a.length>1?a.join(","):(a.length==1?a[0]:0)}else{$(this).each(function(){var e=$(this).data("options");var c=$.val("items",e,{d:null});var d=$.type(c)=="array"?true:false;if(d){b=b.split(",");$(".item",this).each(function(){if($.in_array($("input[type=checkbox]",this).val(),b)){$("input[type=checkbox]",this).prop("checked",true).attr("checked",true)}else{$("input[type=checkbox]",this).prop("checked",false).attr("checked",false)}})}else{b=b==true||b==1?true:false;$("input[type=checkbox]",this).prop("checked",b).attr("checked",b)}})}},checkbox_validate:function(){var a=true;$(this).each(function(){var e=$(this).data("options");var f=$.val("required",e,{d:false});var b=$.val("items",e,{d:null});var d=0;var c=0;$(".item",this).each(function(){var g=$("input[type=checkbox]",this).is(":checked");if(g){c++}d++});if((f==1||f==true)&&c<1){a=false;$(this).addClass("invalid")}else{$(this).removeClass("invalid")}});return a}});$.fn.extend({checklist:function(a){$(this).each(function(){var b=this;var c=[];c.push("<div class='checklist-body'>");c.push("<div class='checklist-item'>");c.push("<input type='checkbox' />");c.push("<input type='text' />");c.push("<span class='iconbar'>");c.push("<span class='checklist-remove fa fa-times padding5 selectable'></span>");c.push("</span>");c.push("</div>");c.push("</div>");c.push("<div class='checklist-foot'>");c.push("<span class='checklist-add fa fa-plus-circle padding5 selectable hoverable'></span>");c.push("</div>");$(this).addClass("checklist");$(this).html(c.join(""));$(".checklist-add",this).click(function(){$(b).checklist_add()});$(".checklist-remove",this).on("click.checklist",function(){$(this).closest(".checklist-item").remove()})})},checklist_add:function(){$(this).each(function(){var a=[];a.push("<div class='checklist-item'>");a.push("<input type='checkbox' />");a.push("<input type='text' />");a.push("<span class='iconbar'>");a.push("<span class='checklist-remove fa fa-times padding5 selectable hoverable'></span>");a.push("</span>");a.push("</div>");$(".checklist-body",this).append(a.join(""));$(".checklist-remove",$(".checklist-body",this)).on("click.checklist",function(){$(this).closest(".checklist-item").remove()})})},checklist_get:function(){var a=[];$(this).each(function(){$(".checklist-item",this).each(function(){var b=$("input[type='checkbox']",this)[0].checked;var c=$("input[type='text']",this).val();if(c.length>0){a.push({checked:b,text:c})}})});return a.length==0?null:a},checklist_set:function(a){$(this).checklist_attr({value:a})},checklist_attr:function(a){if($.type(a)!="object"){return}$(this).each(function(){for(var d in a){var g=a[d];switch(d){case"readonly":if(g){$("input[type='checkbox']",this).attr("disabled",true);$("input[type='text']",this).attr("readonly",true);$(".checklist-remove",this).addClass("hidden");$(".checklist-add",this).addClass("hidden")}else{$("input[type='checkbox']",this).attr("disabled",false);$("input[type='text']",this).attr("readonly",false);$(".checklist-remove",this).removeClass("hidden");$(".checklist-add",this).removeClass("hidden")}break;case"value":var c=[];if($.type(g)=="array"){for(var b=0;b<g.length;b++){var f=g[b];var h=$.val("text",f,{d:""});var e=$.val("checked",f,{d:false});if(h==""){continue}c.push("<div class='checklist-item'>");c.push("<input type='checkbox'"+(e?" checked":"")+"/>");c.push("<input type='text' value=\""+h+'" />');c.push("<span class='iconbar'>");c.push("<span class='checklist-remove fa fa-times padding5 selectable hoverable'></span>");c.push("</span>");c.push("</div>")}}c.push("<div class='checklist-item'>");c.push("<input type='checkbox'/>");c.push("<input type='text'/>");c.push("<span class='iconbar'>");c.push("<span class='checklist-remove fa fa-times padding5 selectable hoverable'></span>");c.push("</span>");c.push("</div>");$(".checklist-body",this).html(c.join(""));$(".checklist-remove",$(".checklist-body",this)).on("click.checklist",function(){$(this).closest(".checklist-item").remove()});break}}})}});$.fn.extend({choice:function(a){$(this).each(function(){var e=$.val("class",a,{d:""});var b=$.val("items",a,{d:[],datatype:"array"});var d=[];if($.type(b)=="array"){for(var c=0;c<b.length;c++){var f=b[c];var g=$.val("value",f,{d:""});var h=$.val("text",f,{d:g});if(g.length==0){continue}d.push($.p('<span class="item">'));d.push($.p("</span>"))}}$(this).addClass("choice");$(this).addClass(e)})}});$.fn.extend({codeeditor:function(c){var a=$.val("height",c,{d:"200px"});var d=$.val("width",c,{d:"300px"});var b=$.val("name",c,{d:""});var e=$.val("value",c,{d:"300px"});this.each(function(){var g=$.uniqid();var f=[];f.push($.p('<textarea id="$1""></textarea>',["codeeditor-text-"+g]));$(this).addClass("codeeditor");$(this).html(f.join(""));$(this).css({width:d,height:a});$(this).codeeditor_attr({name:b});var h=CodeMirror.fromTextArea(document.getElementById("codeeditor-text-"+g),{lineNumbers:true,mode:"text/x-mariadb",indentWithTabs:true,smartIndent:true,matchBrackets:true,autofocus:true})})},codeeditor_get:function(){var a=[];$(this).each(function(){a.push($("textarea",this).val())});return a.length==1?a[0]:(a.length>1?a:"")},codeeditor_set:function(a){$(this).each(function(){$("textarea",this).val(a)})},codeeditor_attr:function(a){this.each(function(){var d={};var e={};var b={};for(var c in b){var f=b[c];switch(c){case"name":b.name=f}}$(this).attr(b);$(this).css(d);$("textarea",this).css(e)})}});$.fn.extend({codefield:function(c){var f=$.val("placeholder",c,{d:""});var b=$.val("name",c,{d:""});var a=$.val("height",c);var e=$.val("width",c);var d={width:e,height:a};this.each(function(){var h=this;var g=[];g.push("<pre style='height:"+a+";'>"+JSON.stringify({name:"andy"},null,2)+"</pre>");g.push("<span class='icon fa hidden'></span>");$(h).addClass("codefield");$(h).css(d);$(h).html(g.join(""));$(h).attr("data-type","codefield");$(h).attr("data-name",b);$(h).data("options",c)})},codefield_get:function(){var a=[];this.each(function(){var b=$("pre",this).html();a.push(b)});return a.length>1?a:(a.length==1?a[0]:"")},codefield_set:function(a){this.each(function(){$("pre",this).html(a)})}});$.fn.extend({commentlist:function(b){var a=$.val("onsubmit",b);$(this).each(function(){var c=this;var d=[];d.push("<div class='commentlist-write'>");d.push("<input type='text' placeholder='Write comment here...' />");d.push("</div>");d.push("<div class='commentlist-list'></div>");$(this).addClass("commentlist");$(this).html(d.join(""));$(this).data("options",b);$("input[type='text']",this).on("keyup",function(f){if(f.keyCode==13){if(f.shiftKey){}else{if(this.value!=""){$.fire_event(a,[this.value],c);this.value="";$(this).blur()}}}})})},commentlist_add:function(a){$(this).each(function(){var c=$(this).data("options");var e=$.val("onremove",c);var i=$.val("id",a);var h=$.val("comment",a);var g=$.val("full_name",a);var f=$.val("createdon",a);var b=$.val("removable",a,{d:0});if(!h||!g){return}var d=[];d.push("<div class='commentlist-item' data-id='"+i+"'>");d.push("<p style='word-wrap: break-word;'><b>"+g+"</b> "+h+"</p>");d.push("<div class='commentlist-item-footer'>");d.push("<label class=''>"+f+"</label>");if(b){d.push("<span class='width5 height5'>&nbsp;</span>");d.push("<span class='comment-item-remove selectable hoverable'>Remove</span>")}d.push("</div>");d.push("</div>");$(".commentlist-list",this).append(d.join(""));$(".comment-item-remove",$(".commentlist-list",this)).on("click",function(){var j=$(this).closest(".commentlist-item").attr("data-id");$.fire_event(e,[j],this)})})},commentlist_set:function(a){$(this).each(function(){var l=$(this).data("options");var e=$.val("onremove",l);var g=[];if($.type(a)=="array"){for(var f=0;f<a.length;f++){var d=a[f];var c=$.val("id",d);var h=$.val("comment",d);var j=$.val("full_name",d);var k=$.val("createdon",d);var b=$.val("removable",d,{d:0});if(!h||!j){continue}g.push("<div class='commentlist-item' data-id='"+c+"'>");g.push("<p style='word-wrap: break-word;'><b>"+j+"</b> "+h+"</p>");g.push("<div class='commentlist-item-footer'>");g.push("<label class=''>"+k+"</label>");if(b){g.push("<span class='width5 height5'>&nbsp;</span>");g.push("<span class='comment-item-remove selectable hoverable'>Remove</span>")}g.push("</div>");g.push("</div>")}}$(".commentlist-list",this).html(g.join(""));$(".comment-item-remove",$(".commentlist-list",this)).on("click",function(){var i=$(this).closest(".commentlist-item").attr("data-id");$.fire_event(e,[i],this)})})}});$.fn.extend({container_val:function(b){if(typeof b=="undefined"){var a={};$("*[data-type]",this).each(function(){if($(this).parent().closest(".grid").length>0){return}var c=this.getAttribute("data-name");if(c!=null&&c!=""){var d=$(this).val();a[c]=d}});return a}else{$("*[data-type]",this).each(function(){var c=this.getAttribute("data-name");if(c!=null&&c!=""){var d=$.val(c,b,{d:""});$(this).val(d)}})}},container_reset:function(){$("*[data-type]",this).each(function(){var a=$(this).attr("data-type");if(a!=null&&typeof $(this)[a+"_reset"]!="undefined"){$(this)[a+"_reset"].apply(this,arguments)}})},container_validate:function(){var a=false;$("*[data-type]",this).each(function(){var b=$(this).attr("data-type");if(b!=null&&typeof $(this)[b+"_validate"]!="undefined"){var c=$(this)[b+"_validate"].apply(this,arguments);console.warn([b,c]);if(!c){a=true}}});return !a}});$.fn.extend({datepicker:function(b){var f=$.val("mode",b,{d:""});var a=$.val("name",b,{d:""});var c=$.val("width",b,{d:""});var d=$.val("defaultvalue",b,{d:""});if(d==""){if(f=="range"){d=$.date("Ymd")+"-"+$.date("Ymd",$.mktime(0,0,0,parseInt($.date("m"))+1,0,parseInt($.date("Y"))))}else{d=$.date("Ymd")}}var e=$.val("value",b,{d:d});if(f=="range"&&c==""){c="240px"}this.each(function(){var i=this;var h=[];h.push("<input type='text' readonly/>");h.push("<span class='icon fa fa-calendar'></span>");$(i).addClass("datepicker");$(i).html(h.join(""));$(i).attr("data-type","datepicker");if(a!=""){$(i).attr("data-name",a)}$(i).data("options",b);var g={};if(!isNaN(parseInt(c))){g.width=c}$(i).css(g);$(".icon",this).click(function(m){m.preventDefault();m.stopPropagation();var l=$(this).closest(".datepicker");var k=$(l).data("options");var j=$.val("readonly",k,{d:false});if(j=="0"||j==false){$.calendar_open({refEl:l,value:$(l).data("value"),mode:f,onchange:function(n){$(l).datepicker_val(n);$.fire_event($.val("onchange",k),[n],l)}})}});$(".popup",this).click(function(j){j.preventDefault();j.stopPropagation()});$(this).datepicker_val(e)})},datepicker_val:function(a){if(typeof a=="undefined"){var a=[];$(this).each(function(){var b=$(this).data("value");a.push(b)});return a.length==1?a[0]:(a.length==0?null:a)}else{$(this).each(function(){var b=$(this).data("options");var i=$.val("mode",b,{d:""});var h="";a=$.date_parse(a);if(i=="range"){var g=a.split("-");var e=g.length!=2&&$.strtotime(g[0])==false?$.date("M j, Y"):$.date("M j, Y",$.strtotime(g[0]));var c=g.length!=2&&$.strtotime(g[1])==false?$.date("M j, Y"):$.date("M j, Y",$.strtotime(g[1]));var j=g.length!=2&&$.strtotime(g[0])==false?$.date("Ymd"):$.date("Ymd",$.strtotime(g[0]));var f=g.length!=2&&$.strtotime(g[1])==false?$.date("Ymd"):$.date("Ymd",$.strtotime(g[1]));h=e+" - "+c;a=j+"-"+f}else{if($.strtotime(a)==false){h=$.date("M j, Y");a=$.date("Ymd")}else{h=$.date("M j, Y",$.strtotime(a))}}$("input",this).val(h);$(this).data("value",a)})}},datepicker_validate:function(){return $(this).element_validate()}});$.fn.extend({dropdown:function(j){var e=$.val("class",j,{d:""});var b=$.val("name",j,{d:""});var i=$.val("default_value",j,{d:""});var h=$.val("value",j,{d:i});var f=$.val("items",j,{d:[]});var c=$.val("width",j,{d:[]});var a=$.val("src",j,{d:""});var g=$.val("placeholder",j,{d:""});j.static_items=f;var d=[];d.push("<input class='text' placeholder=\""+g+'" readonly/>');d.push("<span class='icon fa fa-caret-down hoverable'></span>");d.push("<span class='popup'></span>");this.each(function(){var k=this;$(k).addClass("dropdown");$(k).addClass(e);$(k).html(d.join(""));$(k).data("options",j);$(k).attr("data-type","dropdown");$(k).attr("data-name",b);$(".icon, .text",k).click(function(o){o.preventDefault();o.stopPropagation();var n=$(this).closest(".dropdown");var m=$(n).data("options");var l=$.val("readonly",m);if(!l){if($(".popup",n).hasClass("on")){$.popup_close($(".popup",n))}else{$.popup_open($(".popup",n),n,{min_width:$(n).outerWidth()});$(".search-item input",$(".popup",n)).val("");$(".search-item input",$(".popup",n)).focus();$(".item",$(".popup",n)).show()}}});if($.type(f)=="array"&&f.length>0){$(this).dropdown_items(f)}if(h!=""){$(k).dropdown_val(h)}if(a.length>0){$(this).dropdown_load()}})},dropdown_val:function(c,b){if(typeof c=="undefined"){var a=[];this.each(function(){var d=this;var e=$(d).attr("data-value");var f=$("input",d).length==1?$("input",d).val():$(".text",d).html();e=e==null?f:e;a.push(e)});return a.length==1?a[0]:(a.length>1?a:null)}else{this.each(function(){var e=$(this).data("options");var d=$.val("items",e,{d:[]});var j="";var h="";if($.type(c)=="object"){h=$.val("value",c);j=$.val("text",c,{d:h})}else{if($.type(h)=="string"){j=h=c}}if($.type(d)=="array"){for(var f=0;f<d.length;f++){var g=d[f];if(g.value==h){j=g.text;h=g.value;$(this).attr("data-value",h);$("input",this).val(j);$(".text",this).html(j);break}}}})}},dropdown_items:function(a){if(typeof a=="undefined"){var b=[];this.each(function(){var e=this;var d=$(e).data("options");var c=$.val("items",d,{d:[]});$(c).each(function(){if($.type(this)=="object"){b.push(this)}})});return b}else{this.each(function(){var c=this;var n=$(c).data("options");var h=$.val("searchable",n,{d:false});var o=$.val("multiple",n,{d:false});var d=$.val("onchange",n);var f=[];if(h==true){f.push("<div class='search-item'>");f.push("<input type='text' placeholder='Search'/>");f.push("</div>")}if($.type(a)=="array"){for(var e=0;e<a.length;e++){var l=a[e];var j=$.val("value",l,{d:""});var k=$.val("text",l,{d:j});var m=(k+" "+j).toLowerCase();var g=$.uniqid();f.push("<div class='item' data-value=\""+j+'" data-search="'+m+'">');if(o){f.push("<input type='checkbox' id='dropdown_item_checkbox_"+g+"'/>")}f.push("<label for='dropdown_item_checkbox_"+g+"'>"+k+"</label>");f.push("</div>")}}f=f.join("");$(".popup",c).html(f);$(".item",$(".popup",c)).click(function(t){if(o){t.stopPropagation()}var x=$("label",this).html();var w=$(this).attr("data-value");var s=-1;var q=null;for(var r=0;r<a.length;r++){var y=a[r];var u=$.val("text",y);var p=$.val("value",y);if(p==w||u==x){s=r;q=y;break}}if(q){q._index=s}$("input",c).val(x);$(".text",c).html(x);$(c).attr("data-value",w);$(c).textbox_validate();$.fire_event(d,[t,q],c)});$(".item>input[type='checkbox']",$(".popup",c)).on("change",function(){var p=this.nextElementSibling.innerHTML;var i=this.parentNode.getAttribute("data-value");$(c).dropdown_val({text:p,value:i},true)});$(".popup .search-item input",c).click(function(i){i.preventDefault();i.stopPropagation()});$(".popup .search-item input",c).keyup(function(q){var p=this.value;var i=$(this).closest(".popup");$(".item",i).show();if(p.length>0){$(".item:not([data-search*='"+p+"'])",i).hide()}});n.items=a;$(c).data("options",n)})}},dropdown_load:function(){this.each(function(){var b=this;var a=$(b).data("options");var c=$.val("src",a,{d:""});var d=$.val("method",a,{d:"get"});if(d=="post"){$.api_post(c,{},function(h){var l=$.val("data",h);if($.type(l)=="array"){var g=$.val("map",a,{d:null});var k=$.val("text",g,{d:"text"});var e=$.val("value",g,{d:"value"});var f=$.val("static_items",a,{d:[]});var o=[];if($.type(f)=="array"){for(var j=0;j<f.length;j++){var p=f[j];var m=$.val(e,p,{d:""});var n=$.val(k,p,{d:m});o.push({text:n,value:m})}}if($.type(l)=="array"){for(var j=0;j<l.length;j++){var p=l[j];var m=$.val(e,p,{d:""});var n=$.val(k,p,{d:m});o.push({text:n,value:m})}}l=o;$(b).dropdown_items(l)}})}else{$.api_get(c,{},function(h){var l=$.val("data",h);if($.type(l)=="array"){var g=$.val("map",a,{d:null});var k=$.val("text",g,{d:"text"});var e=$.val("value",g,{d:"value"});var f=$.val("static_items",a,{d:[]});var o=[];if($.type(f)=="array"){for(var j=0;j<f.length;j++){var p=f[j];var m=$.val(e,p,{d:""});var n=$.val(k,p,{d:m});o.push({text:n,value:m})}}if($.type(l)=="array"){for(var j=0;j<l.length;j++){var p=l[j];var m=$.val(e,p,{d:""});var n=$.val(k,p,{d:m});o.push({text:n,value:m})}}l=o;$(b).dropdown_items(l)}})}})},dropdown_reset:function(){$(this).each(function(){var b=$(this).data("options");var a=$.val("default_value",b,{d:""});$(this).dropdown_val(a)})},dropdown_readonly:function(a){$(this).each(function(){if($.istrue(a)){$(this).addClass("readonly")}else{$(this).removeClass("readonly")}})},dropdown_validate:function(){return $(this).element_validate()}});$.fn.extend({droppable:function(a){$(this).each(function(){var c=$.val("accept",a,{d:undefined});if(c==undefined){c="text/plain"}var b=c.split_and_trim(",");$(this).addClass("droppable");$(this).on("dragover",function(d){d.preventDefault();$(this).addClass("drag-over")});$(this).on("dragleave",function(d){d.preventDefault();$(this).removeClass("drag-over")});$(this).on("drop",function(m){m.preventDefault();var f=this;var l=m.originalEvent.dataTransfer.files||m.originalEvent.target.files;var h=[];if(l.length>0){for(var k=0;k<l.length;k++){var j=l[k];var g=j.type;if($.in_array(g,b)){var d=new FileReader();d.onload=function(e){var i=e.target.result;$.fire_event($.val("ondrop",a),[m,i],f)};d.readAsText(j);h.push(j)}}}$(f).data("value",h);$(this).removeClass("drag-over")})})},droppable_val:function(a){if(typeof a=="undefined"){if($(this).hasClass(".droppable")){return $(this).data("value")}else{return false}}else{}}});$.fn.extend({element_validate:function(b){var a=true;$(this).each(function(){var k=$(this).data("options");var c=$.val("name",k,{d:"Field"});var g=$.val("required",k,{d:false});var f=$.val("required_text",k,{d:c+" required."});var d=$.val("validation",k,{d:""});var e=$.val("validation_text",k,{d:"Validation error."});var i=$(this).val();var j="";if(g){if(i.toString().trim()==""){a=false;j=f}else{if(d!=""){switch(d){default:var h=new RegExp(d);a=h.test(i);if(!a){j=e}break}}}}else{if(i.toString().length>0){switch(d){default:var h=new RegExp(d);a=h.test(i);if(!a){j=e}break}}}if(!a){$(this).addClass("invalid")}else{$(this).removeClass("invalid")}});return a}});$.fn.extend({feed:function(a){$(this).each(function(){var c=$.val("class",a,{d:""});var e=$.val("src",a,{d:""});var d=$.val("autoload",a,{d:false});var b=[];b.push("<div class='feed-content'></div>");b.push("<div class='feed-footer'></div>");$(this).addClass("feed");$(this).addClass(c);$(this).html(b.join(""));$(this).data("options",a);if(d){$(this).feed_load()}})},feed_val:function(b,a){if(typeof b=="undefined"){}else{$(this).each(function(){var l=$(this).data("options");var c=$.val("src",l,{d:""});var k=$.val("template",l,{d:""});if($.type(b)=="array"&&b.length>0){var h="feed_group_"+$.uniqid();var j=document.createElement("div");j.setAttribute("data-feed-group-id",h);var g=[];for(var f=0;f<b.length;f++){g.push("<div class='feed-item'></div>")}j.innerHTML=g.join("");$(".feed-content",this).append(j);for(var f=0;f<b.length;f++){var e=b[f];var d=j.childNodes[f];$.fire_event(k,[e],d)}}})}},feed_load:function(a){$(this).each(function(){if(!$(this).hasClass("feed")){return}var b=this;var c=$(this).data("options");var d=$.val("src",c,{d:""});if(d!=""){$.api_post(d,[],function(g){var i=$.val("data",g,{d:[]});var h=$.val("page",g,{d:1});var f=h==1?false:true;$(b).feed_val(i,f);var e=$.val("max_page",g,{d:h});if(e>=h+1){$(".feed-footer",b).html("<div class='load-more align-center padding10'>Load More...</div>");$(".load-more",b).on("click",function(){$(b).feed_load({page:h+1})})}else{$(".feed-footer",b).html("")}})}})}});$.extend({foldedpane_toggle:function(c){var a=$(c);if(typeof a[0]=="undefined"){return}var b=$(".toggler",a);if(a[0].classList.contains("folded")){a[0].classList.remove("folded");if(b.length==1){b.html("<span class='fa fa-caret-up'></span>")}}else{a[0].classList.add("folded");if(b.length==1){b.html("<span class='fa fa-caret-down'></span>")}}},foldedpane_init:function(){var b=document.body.querySelectorAll(".folded-pane");for(var a=0;a<b.length;a++){var c=b[a];var d=c.querySelector(".toggler");if(d!=null){d.addEventListener("click",function(){$.foldedpane_toggle(c)})}}}});$.fn.extend({grid:function(k){var h=$.val("autoload",k,{d:true});var d=$.val("columns",k,{d:[]});var e=$.val("class",k,{d:"style1"});var a=$.val("name",k,{d:""});var f=$.val("footer",k,{d:""});var g=$.val("value",k,{d:null});var b=$.val("width",k,{d:""});var j=$.val("height",k,{d:"auto"});var i=$.val("key",k,{d:""});var c=$.val("scroll_cont",k,{d:null});k.page=0;this.each(function(){var o=this;var n=[];if($(o).html().length==0){n.push("<table class='grid-body'>");n.push("<tbody class='grid-size'></tbody>");n.push("</table>");n.push("<div class='grid-footer'></div>");$(o).html(n.join(""))}var l="grid"+$.uniqid();var m={};if(b!=""){m.width=b}$(o).attr("data-type","grid");$(o).attr("data-cid",l);$(o).attr("data-name",a);$(o).addClass("grid");$(o).addClass(e);$(o).data("options",k);$(o).css(m);$.fire_event(f,[],$(".grid-footer",o));$(this).grid_set_columns(d);if(g!=null){$(o).grid_val(g)}if(h){$(o).grid_load()}if(c!=null){if(c=="window"){$(window).on("scroll",function(){$(".load-more",$("*[data-cid='"+l+"']")).each(function(){if($.is_in_viewport(this)){this.click()}})})}else{$(c).on("scroll",function(){$(".load-more",$("*[data-cid='"+l+"']")).each(function(){if($.is_in_viewport(this)){this.click()}})})}}})},grid_remove:function(a){if(typeof a=="undefined"){return}$(this).each(function(){if(a instanceof HTMLElement){if($(a).closest(".grid").length==1){$(a).remove()}}else{if($.type(a)=="object"){var d=$(this).data("options");var e=$.val("key",d,{d:""});e=e.split(",");var b=[];for(var c=0;c<e.length;c++){if(e[c].length>0&&typeof a[e[c]]!="undefined"){b.push(a[e[c]])}}b=b.join("");$('tr[data-key="'+b+'"]',this).remove()}}})},grid_modify:function(a,b){if(typeof a=="undefined"){return}if(typeof b=="undefined"&&!$.type(b)=="object"){return}$(this).each(function(){if($.type(a)=="object"){var e=$(this).data("options");var g=$.val("columns",e,{d:[]});var f=$.val("key",e,{d:""});f=f.split(",");var c=[];for(var d=0;d<f.length;d++){if(f[d].length>0&&typeof a[f[d]]!="undefined"){c.push(a[f[d]])}}c=c.join("");$('tr[data-key="'+c+'"]',this).each(function(){var h=$(this).data("value");for(var j in b){h[j]=b[j]}$(this).html($.grid_row(g,h,e));var i=0;$("td",this).each(function(){var n=this;var m=n.getAttribute("data-column-type");if(m=="html"){var k=g[i];var l=$.val("html",k,{d:""});$.fire_event(l,[h,k],n)}i++});$(this).data("value",h);$(this).addClass("highlight")})}})},grid_add:function(b,a){$(this).each(function(){var n=this;var o=$(n).data("options");var d=$.val("columns",o,{d:[]});var i=$.val("onselect",o);var m=$.val("key",o,{d:""});m=m.split(",");var c=[];for(var f=0;f<m.length;f++){if(m[f].length>0&&typeof b[m[f]]!="undefined"){c.push(b[m[f]])}}c=c.join("");var k=document.createElement("tr");$(k).html($.grid_row(d,b,o)).attr("data-key",c);var h=$("tr:not(.grid-size-tr)",this);var e=null;if($.type(a)=="number"){e=typeof h[a]!="undefined"?h[a]:e}if(e!=null){$(k).insertBefore(e)}else{var l=$(".grid-content",this).last();if(l.length>0){$(l).append(k)}else{var g=document.createElement("tbody");g.className="grid-content";$(".grid-body",n).append(g);$(g).append(k)}}$(k).on("click.gridrow",function(p){$(this).removeClass("highlight");var j=$(this).closest("table");$(".active",j).removeClass("active");$(this).addClass("active");$.fire_event(i,[p,this],n)}).addClass("highlight").each(function(){var j=0;$("td",this).each(function(){var s=this;var r=s.getAttribute("data-column-type");if(r=="html"){var p=d[j];var q=$.val("html",p,{d:""});$.fire_event(q,[b,p],s)}j++})}).data("value",b)})},grid_set_columns:function(a){$(this).each(function(){if(!$(this).hasClass("grid")){return}var c=$(this).data("options");c.columns=a;$(this).data("options",c);var e=[];e.push("<tr class='grid-size-tr'>");for(var d=0;d<a.length;d++){var g=a[d];var b=$.val("name",g);var f=$.val("width",g);var h=$.val("active",g,{d:1});if(h==1){e.push($.p("<td class='grid-size-label' style='width:$1' data-key='"+b+"'></td>",[f]))}else{e.push($.p("<td class='grid-size-label inactive' style='width:$1' data-key='"+b+"'></td>",[f]))}}e.push("<td style='width:100%'></td>");e.push("</tr>");$(".grid-size",this).html(e.join(""))})},grid_load:function(a){this.each(function(){var g=this;var j=$(g).data("options");var c=$.val("src",j,{d:""});var b=$.val("method",j,{d:"post"});if(c.length>0){var f=$.val("page",a,{d:1});var h=$.val("row_per_page",j,{d:10});var e=$.val("columns",j);var i=$.val("search",a,{d:""});var d={page:f,row_per_page:h,columns:e,filters:$.val("filters",a),sorts:$.val("sorts",a)};if(i!=""){d.search=i}console.log(["grid_load.el_params",d]);if(b.toString().toLowerCase()=="get"){$.api_get(c,d,function(l){var o=$.val("data",l,{d:[]});var n=$.val("page",l,{d:1});var k=n==1?false:true;$(g).grid_val(o,k);var m=$.val("next_page",l,{d:n});if(m>n){$(".grid-footer",g).html("<div class='load-more align-center padding10'>Load More...</div>");$(".load-more",g).on("click",function(){a.page=m;console.log(a);$(g).grid_load(a)})}else{$(".grid-footer",g).html("")}})}else{$.api_post(c,d,function(l){var o=$.val("data",l,{d:[]});var n=$.val("page",l,{d:1});var k=n==1?false:true;$(g).grid_val(o,k);var m=$.val("next_page",l,{d:n});if(m>n){$(".grid-footer",g).html("<div class='load-more align-center padding10'>Load More...</div>");$(".load-more",g).on("click",function(){a.page=m;console.log(a);$(g).grid_load(a)})}else{$(".grid-footer",g).html("")}})}if(f==1){$(".grid-content",this).remove()}$(".grid-footer",this).html("<div class='align-center padding10'><span class='loading width16 height16'></span></div>")}})},grid_val:function(b,a){if(typeof b=="undefined"){var b=[];this.each(function(){var d=this;var e=d.querySelector(".grid-body");var c=$("tbody",e);$(c).children().each(function(){if(this.classList.contains("grid-size-tr")){}else{var f=$(this).data("value");var g=$.el_val(this);var h=$.array_merge(f,g);b.push(h)}})});return b}else{this.each(function(){var p=this;var q=$(p).data("options");var m=$.val("onselect",q);var e=$.val("columns",q,{d:[]});if(typeof a=="undefined"||a!=true){$(".grid-content",p).remove()}var k=document.createElement("tbody");k.className="grid-content";k.innerHTML=$.grid_html(b,q);$(".grid-body",p).append(k);for(var h=0;h<k.childNodes.length;h++){var o=k.childNodes[h];var g=b[h];for(var f=0;f<o.childNodes.length;f++){var d=o.childNodes[f];var n=d.getAttribute("data-column-type");if(n=="html"){var c=e[f];var l=$.val("html",c,{d:""});$.fire_event(l,[g,c],d)}}$(o).data("value",g)}$("tr",k).on("click.gridrow",function(j){$(this).removeClass("highlight");var i=$(this).closest("table");$(".active",i).removeClass("active");$(this).addClass("active");$.fire_event(m,[j,this],p)})})}},grid_reset:function(){$(this).grid_val([])},grid_get_selected_value:function(){var a=null;$(this).each(function(){var c=$(this).data("options");var d=$.val("data",c);var b=$("tr[class='active']").attr("data-idx");a=$.val(b,d)});return a}});$.extend({grid_html:function(f,n){if(!f){return}var c=$.val("columns",n,{d:[]});var l=$.val("key",n,{d:""});l=l.split(",");var m=$.val("moveable",n,{d:false});var b=m?" draggable='true' ondragstart='$.grid_ondragstart.apply(this, arguments)'":"";var h=[];for(var g=0;g<f.length;g++){var e=f[g];var a=[];for(var d=0;d<l.length;d++){if(l[d].length>0&&typeof e[l[d]]!="undefined"){a.push(e[l[d]])}}a=a.join("");var k="g"+$.uniqid();h.push('<tr data-key="'+a+"\" data-cid='"+k+"'"+b+">");h.push($.grid_row(c,e,n));h.push("</tr>")}return h.join("")},grid_row:function(a,p,e){var m=[];var t=$.val("moveable",e,{d:false});var i=t?" ondrop='$.grid_ondrop.apply(this, arguments)' ondragover='$.grid_ondragover.apply(this, arguments)' ondragleave='$.grid_ondragleave.apply(this, arguments)'":"";for(var r=0;r<a.length;r++){var d=a[r];var c=$.val("type",d,{d:"text"});var g=$.val("datatype",d,{d:"text"});var u=$.val("name",d,{d:""});var n=$.val("align",d,{d:""});var f="";var b="";var l="";switch(c){case"html":break;case"enum":var o=$.val("enum",d,{d:[]});l=$.val(u,p,{d:""});if($.type(o)=="array"){for(var q=0;q<o.length;q++){if($.val("value",o[q])==l){l=$.val("text",o[q]);break}}}break;default:switch(g){case"number":case"money":f="right";l=$.val(u,p,{d:0});l=$.number_format(l);break;case"enum":var s=$.val("enums",d,{d:{}});l=$.val(u,p,{d:"-"});l=$.val(l,s,{d:"-"});break;default:l=$.val(u,p,{d:"-"});break}var h=$.val("lettercase",d,{d:""});switch(h){case"capitalize":l=l.toString().capitalize();break;case"lowercase":l=l.toString().toLowerCase();break;case"uppercase":l=l.toString().toUpperCase();break}b="label";break}if(n!=""){f=n}m.push("<td data-column-type='"+c+"' class='"+b+"' style='text-align:"+f+"'"+i+">"+l+"</td>")}m.push("<td"+i+"></td>");return m.join("")},grid_ondrop:function(){$(this).closest("tr").removeClass("drag-over");var e=$(this).closest(".grid").data("drag_cid");if($("tr[data-cid="+e+"]").index()>$(this).closest("tr").index()){$("tr[data-cid="+e+"]").insertBefore($(this).closest("tr"))}else{$("tr[data-cid="+e+"]").insertAfter($(this).closest("tr"))}var c=$(this).closest(".grid").data("options");var b=$.val("onmove",c,{d:null});var a=$("tr[data-cid="+e+"]")[0];var d=$(this).closest("tr")[0];$.fire_event(b,[a,d],$(this).closest(".grid")[0])},grid_ondragstart:function(a){var b=$(this).closest("tr").attr("data-cid");$(this).closest("tr").addClass("dragging");$(this).closest(".grid").data("drag_cid",b);a.dataTransfer.setData("cid",b)},grid_ondragleave:function(a){$(this).closest("tr").removeClass("drag-over");var b=$(this).closest(".grid").data("drag_cid");$("tr[data-cid="+b+"]").removeClass("dragging")},grid_ondragover:function(a){$(this).closest("tr").addClass("drag-over");a.preventDefault()}});$.fn.extend({gridhead:function(i){var g=$.val("autoload",i,{d:true});var d=$.val("columns",i,{d:[]});var f=$.val("class",i,{d:null});var b=$.val("name",i,{d:""});var c=$.val("width",i,{d:""});var a=$.val("grid",i,{d:null});var h=$.val("height",i,{d:null});var e=$.val("droppable",i,{d:false});this.each(function(){var k=this;$(k).addClass("gridhead");$(k).addClass(f);$(k).attr("data-type","gridhead");if(b!=""){$(k).attr("data-name",b)}$(k).data("options",i);$(k).attr("data-type","gridhead");$(k).gridhead_attr({height:h});var j={};if(c!=""){j.width=c}$(k).css(j);$(this).gridhead_set(d);if(e){$(this).droppable({accept:"text/csv, application/csv",ondrop:function(t,u){try{var q=$.csv.toArrays(u);var w=$(this).data("options");var o=$.val("columns",w,{d:[]});var l=$.val("grid",w,{d:null});var u=[];if($.type(o)=="array"){for(var s=0;s<q.length;s++){var x=q[s];var r={};for(var p=0;p<o.length&&typeof q[p]!="undefined";p++){var n=o[p];var m=n.name;r[m]=x[p]}u.push(r)}}$(l).grid_val(u)}catch(t){}}})}})},gridhead_set:function(a){$(this).each(function(){var f=this;var q=$(this).data("options");var b=$.val("grid",q,{d:null});var o=$.val("oncolumnclick",q);q.columns=a;var k=[];k.push("<table class='grid-head'><tr>");for(var j=0;j<a.length;j++){var h=a[j];var c=$.val("name",h,{d:""});var e=$.val("active",h,{d:1});var p=$.val("text",h,{d:"-"});var n=$.val("width",h,{d:""});var d=$.val("datatype",h,{d:"text"});var g=$.val("align",h,{d:""});var l="";switch(d){case"number":case"money":l="right";break;case"enum":break;default:break}if(g!=""){l=g}var m="label"+(!e?" inactive":"");k.push("<td class='"+m+"' style='width:"+n+";text-align:"+l+"' data-key=\""+c+'">'+p+"<span class='separator'></span></td>")}k.push("<td style='width:100%'></td>");k.push("</tr></table>");$(f).html(k.join(""));$(".separator",f).mousedown(function(t){t.preventDefault();t.stopPropagation();var r=this.parentNode;var s=r.parentNode;var i=t.clientX;$(window).on("mousemove.gridhead",function(w){w.preventDefault();w.stopPropagation();var u=w.clientX-i;r.style.width=(parseInt(r.style.width)+u)+"px";i=w.clientX});$(window).on("mouseup.gridhead",function(z){z.preventDefault();z.stopPropagation();var x=$(b);var B=$(".grid-size",x);if(B.length==1){var w=-1;for(var y=0;y<s.childNodes.length;y++){if(s.childNodes[y]==r){w=y;break}}w=parseInt(w);$(".grid-size-label:eq("+(w)+")",B).css({width:$(r).outerWidth()});var u=$(f).data("options");u.columns[w]["width"]=$(r).outerWidth();var A=$.val("oncolumnresize",u);$.fire_event(A,[{index:w,width:$(r).outerWidth()}],f)}$(window).off("mousemove.gridhead");$(window).off("mouseup.gridhead")})});$(".separator",f).click(function(i){i.preventDefault();i.stopPropagation()});$(".label",f).on("click",function(s){s.preventDefault();s.stopPropagation();var r=$(this).attr("data-key");var i=$(this).attr("data-sorttype");if(i=="asc"){i="desc"}else{if(i=="desc"){i="asc"}else{i="asc"}}$(this).attr("data-sorttype",i);$.fire_event(o,[[{key:r,type:i}]],f)})})},gridhead_attr:function(a){$(this).each(function(){for(var b in a){var c=a[b];switch(b){case"height":$(this).css({height:c});break}}})},gridhead_columns:function(a){if(typeof a=="undefined"){return $.val("columns",$(this).data("options"),{d:[]})}else{$(this).each(function(){if(!$(this).hasClass("gridhead")){return}var n=$(this).data("options");var b=$.val("grid",n);var m=$.val("columns",n);for(var k=0;k<m.length;k++){var e=m[k];var l=$.val("name",e,{d:""});var d=$.val("width",e,{d:""});if(l==""){continue}for(var h=0;h<a.length;h++){var g=a[h];var c=$.val("name",g,{d:""});var f=$.val("active",g,{d:1});if(l==c){if(f){$(".label[data-key='"+c+"']",this).removeClass("inactive");$(".grid-size-label[data-key='"+c+"']",$(b)).removeClass("inactive")}else{$(".label[data-key='"+c+"']",this).addClass("inactive");$(".grid-size-label[data-key='"+c+"']",$(b)).addClass("inactive")}n.columns[k]["active"]=f;column_exists=true}}}$(this).data("options",n)})}}});$.fn.extend({gridsetting:function(b){var a=$.val("onchange",b);this.each(function(){var d=this;var c=[];c.push("<div class='modal-head'>");c.push("<div class='align-center padding10'>");c.push("<ul class='tab'>");c.push("<li class='active' data-value='presets'>Presets</li>");c.push("<li data-value='columns'>Columns</li>");c.push("<li data-value='filters'>Filters</li>");c.push("</ul>");c.push("</div>");c.push("</div>");c.push("<div class='modal-body padding20'>");c.push("<div class='cont12 space10 gridsetting-presets'>");c.push("<div class='lg12'><button class='blue preset-add-btn'><span class='fa fa-plus'></span> Add Preset...</button></div>");c.push("<div class='lg12'><span class='preset-grid'></span></div>");c.push("</div>");c.push("<div class='cont12 space10 gridsetting-columns' style='display:none'>");c.push("<div class='lg12'>");c.push("<button class='blue column-up-btn'><span class='fa fa-caret-up'></span>Up</button>");c.push("&nbsp;");c.push("<button class='blue column-down-btn'><span class='fa fa-caret-down'></span>Down</button>");c.push("</div>");c.push("<div class='lg6'><span class='column-grid'></span></div>");c.push("<div class='lg6'>");c.push("<div class='cont12 space10 gridsetting-column-detail'>");c.push("<div class='lg3 align-right'><label class='padding10'>Align</label></div>");c.push("<div class='lg9'><span class='gridsetting-column-align'></span></div>");c.push("<div class='lg3 align-right'><label class='padding10'>Name</label></div>");c.push("<div class='lg9'><label class='gridsetting-column-name padding10'></label></div>");c.push("<div class='lg3 align-right'><label class='padding10'>Text</label></div>");c.push("<div class='lg9'><span class='gridsetting-column-text'></span></div>");c.push("<div class='lg3 align-right'><label class='padding10'>Width</label></div>");c.push("<div class='lg9'><span class='gridsetting-column-width'></span></div>");c.push("</div>");c.push("</div>");c.push("</div>");c.push("<div class='cont12 space10 gridsetting-filters' style='display:none'>");c.push("<div class='lg12'><button class='blue filter-add-btn'><span class='fa fa-plus'></span> Add Filter...</button></div>");c.push("<div class='lg12'><span class='filter-grid'></span></div>");c.push("</div>");c.push("</div>");c.push("<div class='modal-foot'>");c.push("<button class='blue apply-btn'><span class='fa fa-save'></span> Apply Filter</button>");c.push("&nbsp;");c.push("<button class='close-btn'><span class='fa fa-times'></span> Close</button>");c.push("</div>");$(d).addClass("modal width800 gridsetting");$(d).html(c.join(""));$(".tab",d).tab({onchange:function(e){$(".modal-body",d).children().hide();$(".gridsetting-"+e.value,d).show()}});$(".preset-add-btn").click(function(){});$(".preset-grid",d).grid({"class":"transparent",columns:[{text:"",type:"html",html:"$.gridsetting_preset_option",width:"50px"},{text:"Preset Name",name:"text",width:"150px"}]});$(".column-grid",d).grid({"class":"transparent",columns:[{text:"Column Name",name:"text",width:"150px"},{text:"Width",name:"width",width:"100px"}],onselect:function(g){var e=$(this).closest(".gridsetting-columns");var f=$(".gridsetting-column-detail",e);$.el_set(f,g);$(".gridsetting-column-name",f).html($.val("name",g,{d:""}))}});$(".gridsetting-column-align",d).dropdown({name:"align",items:[{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]});$(".gridsetting-column-name",d).html("");$(".gridsetting-column-text",d).textbox({name:"text",onchange:function(j){var e=$(d).data("params");var h=$(this).closest(".gridsetting-column-detail");var f=$(".gridsetting-column-name",h).html();for(var g=0;g<e.presets[e.active_idx]["columns"].length;g++){if(e.presets[e.active_idx]["columns"][g]["name"]==f){e.presets[e.active_idx]["columns"][g]["text"]=j}}$(d).data("presets",e)}});$(".gridsetting-column-width",d).textbox({name:"width",onchange:function(j){var e=$(d).data("params");var h=$(this).closest(".gridsetting-column-detail");var f=$(".gridsetting-column-name",h).html();for(var g=0;g<e.presets[e.active_idx]["columns"].length;g++){if(e.presets[e.active_idx]["columns"][g]["name"]==f){e.presets[e.active_idx]["columns"][g]["width"]=j}}$(d).data("presets",e)}});$(".filter-add-btn",d).click(function(){$(".filter-grid",d).grid_add()});$(".filter-grid",d).grid({"class":"transparent",columns:[{text:"",type:"html",html:"$.gridsetting_grid_option",width:"50px"},{text:"Key",type:"html",html:"$.gridsetting_grid_key",width:"150px"},{text:"Operator",type:"html",html:"$.gridsetting_grid_opt",width:"150px"},{text:"Value",type:"html",html:"$.gridsetting_grid_val",width:"150px"}]});$(".apply-btn",d).click(function(){var e=$(".filter-grid",d).grid_value();var g=$(d).data("params");var f=parseInt($.val("active_idx",g,{d:0}));g.presets[f]["filters"]=e;$.fire_event(a,[g],d);$(d).modal_close()});$(".close-btn",d).click(function(){$(d).modal_close()})})},gridsetting_close:function(){$(this).modal_close()},gridsetting_open:function(b,a){this.each(function(){var c=$.val("presets",b);var f=b.presets[b.active_idx];var d=$.val("columns",b);var e=$.val("filters",b);$(this).data("params",b);$(this).data("columns",d);$(".preset-grid",this).grid_set(c);$(".column-grid",this).grid_set(d);$(".filter-grid",this).grid_set(e);$(this).modal_open({height:window.innerHeight*0.8})})}});$.extend({gridsetting_preset_option:function(a){$(this).html("<button class='preset-grid-options'><span class='fa fa-times'></span></button>");$(".preset-grid-options",this).click(function(){$(this).closest("tr").remove()})},gridsetting_grid_option:function(a){$(this).html("<button class='filter-grid-options'><span class='fa fa-times'></span></button>");$(".filter-grid-options",this).click(function(){$(this).closest("tr").remove()})},gridsetting_grid_type:function(a){$(this).html("<span class='filter-grid-type'></span>");$(".filter-grid-type",this).textbox({name:"type",value:$.val("type",a,{d:null})})},gridsetting_grid_key:function(f,d){var b=$(this).closest(".gridsetting");var e=$(b).data("params");var k=e.presets[e.active_idx];var d=e.columns;var h=[];if($.type(d)=="array"){for(var g=0;g<d.length;g++){var c=d[g];var a=$.val("name",c,{d:""});var j=$.val("text",c,{d:a});if(a.length>0){h.push({text:j,value:a})}}}$(this).html("<span class='filter-grid-key'></span>");$(".filter-grid-key",this).dropdown({name:"key",items:h,value:$.val("key",f,{d:null})})},gridsetting_grid_opt:function(a){$(this).html("<span class='filter-grid-opt'></span>");$(".filter-grid-opt",this).dropdown({name:"operator",items:[{text:"Contains",value:"contains"},{text:"Equals",value:"equals"}],value:$.val("operator",a,{d:null})})},gridsetting_grid_val:function(a){$(this).html("<span class='filter-grid-val'></span>");$(".filter-grid-val",this).textbox({name:"value",value:$.val("value",a,{d:null})})}});$.fn.extend({hidden:function(b){var a=$.val("name",b,{d:""});$(this).each(function(){var c=[];$(this).html(c.join(""));$(this).attr("data-type","hidden");$(this).attr("data-name",a);$(this).addClass("hidden");$(this).data("options",b)})},hidden_val:function(b){if(typeof b=="undefined"){var a=[];$(this).each(function(){a.push($(this).data("value"))});return a.length>1?a:(a.length==1?a[0]:"")}else{$(this).each(function(){$(this).data("value",b)})}},hidden_reset:function(){$(this).hidden_val("")}});$.fn.extend({image:function(d){var f=$.val("class",d,{d:""});var a=$.val("height",d,{d:"50px"});var c=$.val("name",d,{d:""});var g=$.val("value",d,{d:""});var e=$.val("width",d,{d:"50px"});var b=$.val("readonly",d,{d:false});this.each(function(){var i=this;var h=[];h.push("<img class='image-img'/>");h.push("<input type='file' accept='image/*'/>");h.push("<span class='image-upload glyphicons glyphicons-folder-open'></span>");h.push("<span class='popup'><img class='image-popup-img'/></span>");$(i).attr("data-type","image");$(i).attr("data-name",c);$(i).addClass("image");$(i).addClass(f);if(b){$(i).addClass("readonly")}$(i).html(h.join(""));$(i).data("options",d);$(".image-img",i).css({width:e,height:a});$(".image-popup-img",this).css({"max-width":window.innerWidth*0.8,"max-height":window.innerHeight*0.8});$(".image-upload",this).on("click",function(j){j.preventDefault();$(this).prev().click()});$(".image-img",this).on("click",function(k){k.preventDefault();k.stopPropagation();var j=$(".popup",$(this).closest(".image"));$(".image-popup-img",j).attr("src",$(this).attr("src"));$.popup_open(j)});$("input[type=file]",this).on("change",function(l){var k=this;if(FileReader&&this.files&&this.files.length){var j=new FileReader();j.onload=function(){k.previousElementSibling.src=j.result};j.readAsDataURL(this.files[0])}});$(".image-img",this).error(function(){$(this).parent().addClass("no-image")});if(g!=""){$(this).image_val(g)}})},image_val:function(b){if(typeof b=="undefined"){var a=[];this.each(function(){a.push($("input[type=file]",this)[0].files[0])});return a.length>1?a:(a.length==1?a[0]:"")}else{this.each(function(){$(".image-img",this).attr("src",b)})}},image_reset:function(){$(this).image_val("")},image_validate:function(){console.log(["image_validate"]);var a=true;$(this).each(function(){var b=$(this).data("options");var d=$.val("required",b,{d:false});var c=$(".image-img",this).attr("src");if(d&&c==""){a=false;$(this).addClass("invalid")}else{$(this).removeClass("invalid")}});return a}});$.extend({layout_resize:function(){$(".layout-sidebar, .layout-main, .layout-ext",$(".layout")).css({height:window.innerHeight-$(".header").outerHeight()})}});$.fn.extend({layout:function(b){var d=$.val("class",b,{d:""});var c=$.val("size",b,{d:{}});var e=$.val("large",c,{d:"300px auto 400px"});var a=e.split(" ");$(this).each(function(){var f=$.val(0,a,{d:"200px"});var h="100%";var g=$.val(2,a,{d:"300px"});$(this).addClass("layout");$(this).addClass(d);$(".layout-sidebar",this).css({flex:"0 0 "+f});$(".layout-main",this).css({flex:"1 1 "+h});$(".layout-ext",this).css({flex:"0 0 "+g});$(".layout-sidebar, .layout-main, .layout-ext",this).css({height:window.innerHeight-$(".header").outerHeight()})});$(window).on("resize.layout",function(){$.layout_resize()})}});$.extend({layout2_resize:function(){$(".layout2").layout2_resize()}});$.fn.extend({layout2:function(a){var c=$.val("class",a,{d:""});var b=$.val("size",a,{d:"300px auto 400px"});var d=b.split(" ");$(this).each(function(){$(this).addClass("layout2");$(this).addClass(c);$(this).data("options",a);$(this).layout2_resize()});$(window).on("resize.layout",function(){$.layout2_resize()})},layout2_resize:function(){$(this).each(function(){var i=$(this).data("options");var a=$.val("onresize",i);var d=$.val("ext_hidden",i);var h=$.val("size",i,{d:"300px auto 400px"});var g=h.split(" ");var e=window.innerHeight-$(".header").outerHeight();var b=$.val(0,g,{d:"200px"});var c=$.val(2,g,{d:"300px"});var e=window.innerHeight-$(".header").outerHeight();c=$.calc_size(c,e);var f=e-c;$(".layout-sidebar",this).css({flex:"0 0 "+b,height:e});$(".layout-content",this).css({flex:"1 1 auto"});if(d==0){$(this).removeClass("ext-hidden");$(".layout-main",this).css({height:c});$(".layout-ext",this).css({height:f})}else{$(this).addClass("ext-hidden");$(".layout-main",this).css({height:e});$(".layout-ext",this).css({height:0})}$.fire_event(a,[],this)})},layout2_toggleext:function(a){$(this).each(function(){if(!$(this).hasClass("layout2")){return}var b=$(this).data("options");b.ext_hidden=a?0:1;$(this).data("options",b);$(this).layout2_resize()})},layout2_ext_state:function(){var a=0;$(this).each(function(){var b=$(this).data("options");a=$.val("ext_hidden",b,{d:-1})>0?0:1});return a}});$.fn.extend({modal_open:function(a){this.each(function(){var b=this;$(b).addClass("on");$(document.body).css({overflow:"hidden"});$(b).css({height:$.val("height",a,{d:window.innerHeight}),width:$.val("width",a,{d:"100%"})});var e=$(b).outerHeight()-5-($(".modal-head",b).outerHeight()+$(".modal-foot",b).outerHeight());if(!isNaN(e)){$(".modal-body",b).css({height:e})}var g=(window.innerWidth-b.clientWidth)/2;var f=(window.innerHeight-b.clientHeight)/2;$(b).css({left:g,top:f});$(".modal-bg").addClass("on");var c=$.val("reset",a,{d:false});if(c===true){$(b).reset()}var d=$.val("value",a,{d:null});if(d!=null){$(b).val(a.value)}})},modal_close:function(){$(this).each(function(){$(this).removeClass("on")});if($(".modal.on").length==0){$(".modal-bg").removeClass("on");$(document.body).css({overflow:""})}}});$.extend({popup_close:function(a){$(a).removeClass("on")},popup_open:function(b,c,k){$.popup_close_all();$(b).addClass("on");var f={};if(typeof c=="undefined"){var a=$(b).outerWidth();var i=$(b).outerHeight();f.left=Math.round((window.innerWidth-a)/2);f.top=Math.round((window.innerHeight-i)/2)}else{var e=$(c).offset();var j=e.left+b.clientWidth;var h=e.top-$(window).scrollTop()+$(c).outerHeight()+1;var g=window.innerHeight-h-10;f.top=h;f["max-height"]=g;if(j>window.innerWidth){e.left=window.innerWidth-b.clientWidth}f.left=e.left;var d=$.val("min_width",k);if(!isNaN(parseInt(d))){f["min-width"]=d}}$(b).css(f)},popup_toggle:function(c,a,b){if(c.classList.contains("on")){$.popup_close(c,a,b)}else{$.popup_open(c,a,b)}},popup_close_all:function(){var a=document.body.querySelectorAll(".popup");for(var b=0;b<a.length;b++){$.popup_close(a[b])}}});$.fn.extend({radio:function(a){$(this).each(function(){var g=$.val("items",a,{d:null});var f=$.val("class",a,{d:""});var n=$.val("text",a,{d:""});var b=$.val("name",a,{d:""});var j=$.val("value",a,{d:""});var d=[];if($.type(g)=="array"){var o="radio-name-"+$.uniqid();for(var c=0;c<g.length;c++){var m=g[c];var l=m.text;var k=m.value;var h=j!=""&&j==k?true:false;var e="radio-"+$.uniqid();d.push("<input type='radio' id='"+e+"' value=\""+k+"\" name='"+o+"'"+(h?" checked":"")+"/>");d.push("<label for='"+e+"'>"+l+"</label>")}}else{var h=parseInt(j)==1||j===true?true:false;var e="radio-"+$.uniqid();d.push("<input type='radio' id='"+e+"'"+(h?" checked":"")+"/>");d.push("<label for='"+e+"'>"+n+"</label>")}$(this).addClass("radio");$(this).addClass(f);$(this).attr({"data-type":"radio","data-name":b});$(this).html(d.join(""))})},radio_val:function(b){if(typeof b=="undefined"){var a=[];$(this).each(function(){var c=this.querySelectorAll("input");if(c.length==1){a.push(c[0].checked?1:0)}else{for(var d=0;d<c.length;d++){if(c[d].checked){a.push(c[d].value)}}}});a=a.join(",");return a}else{$(this).each(function(){var c=this.querySelectorAll("input");if(c.length==1){c[0].checked=(parseInt(b)==1||b===true)?true:false}else{var e=false;for(var d=0;d<c.length;d++){if(c[d].value==b){c[d].checked=true;e=true;break}}if(!e){$("input",this).attr("checked",false)}}})}}});$.extend({role_init:function(b){var a=typeof b!="undefined"&&b instanceof HTMLElement?b:document.body;$("*[data-role]",a).each(function(){var d=this.getAttribute("data-role");switch(d){case"modal.close":$(this).click(function(){$(this).closest(".modal").modal_close()});break;case"url.open":var c=$(this).attr("data-role-value");$(this).click(function(){window.location=c});break}})}});$.fn.extend({spinner:function(a){var b=$.val("size",a,{defaultvalue:"20px"});this.each(function(){var c=[];c.push('<div class="sk-fading-circle" style="width:'+b+";height:"+b+';">');c.push('<div class="sk-circle1 sk-circle"></div>');c.push('<div class="sk-circle2 sk-circle"></div>');c.push('<div class="sk-circle3 sk-circle"></div>');c.push('<div class="sk-circle4 sk-circle"></div>');c.push('<div class="sk-circle5 sk-circle"></div>');c.push('<div class="sk-circle6 sk-circle"></div>');c.push('<div class="sk-circle7 sk-circle"></div>');c.push('<div class="sk-circle8 sk-circle"></div>');c.push('<div class="sk-circle9 sk-circle"></div>');c.push('<div class="sk-circle10 sk-circle"></div>');c.push('<div class="sk-circle11 sk-circle"></div>');c.push('<div class="sk-circle12 sk-circle"></div>');c.push("</div>");$(this).html(c.join(""))})}});$.extend({__sticky_store:{},sticky_add:function(b){var a="sticky"+$.uniqid();$(b).css({height:$(b).outerHeight()});$(b).attr("data-stickyid",a);$.__sticky_store[a]=$(b)[0].offsetTop;$(window).on("scroll.sticky",function(){for(var c in $.__sticky_store){var d=$.__sticky_store[c];if(document.body.scrollTop>d){$(".stickybar").append($("*[data-stickyid="+c+"]").children())}else{$("*[data-stickyid="+c+"]").append($(".stickybar").children())}}})}});$.fn.extend({tab:function(d){var a=$.val("container",d,{d:""});var c=$.val("name",d,{d:""});var b=$.val("onchange",d);var e=$.val("default_index",d,{d:0});this.each(function(){var f=this;$(f).addClass("tab");$(f).attr("data-type","tab");$(f).attr("data-name",c);$(f).data("options",d);var g=0;$("li",f).each(function(){if(g==e){this.classList.add("active")}else{this.classList.remove("active")}g++});$("li",f).click(function(){if(this.classList.contains("active")){}else{$("li",this.parentNode).removeClass("active");$(this).addClass("active");var j=this.innerHTML;var i=this.getAttribute("data-value");if(i==null){i=$.slug(j)}var h=$(this).index();if($(a).length>0){$(a+">*").addClass("off");$(a+">*:eq("+h+")").removeClass("off")}$.fire_event(b,[{text:j,value:i}],f)}})})},tab_set:function(d){var c=this;var b=$(c).data("options");var a=$.val("onchange",b);$("li",this).removeClass("active");$("li",this).each(function(){var e=this.innerHTML;var f=this.getAttribute("data-value");if(f==null){f=$.slug(e)}if(f==d){$(this).addClass("active");$.fire_event(a,[{text:e,value:f}],c)}})}});$.fn.extend({textarea:function(p){var j=$.val("class",p,{d:""});var o=$.val("default_value",p,{d:""});var d=$.val("maxlength",p,{d:""});var b=$.val("name",p,{d:""});var k=$.val("onblur",p);var e=$.val("onchange",p);var a=$.val("onkeyup",p);var m=$.val("placeholder",p,{d:""});var f=$.val("readonly",p,{d:false});var n=$.val("height",p,{d:"1em"});var i=$.val("max-height",p,{d:""});var c=$.val("width",p,{d:""});var l=$.val("value",p,{d:o});var h=$.val("droppable",p,{d:true});var g={};if(c!=""){g.width=c}if(i!=""){g["max-height"]=i}this.each(function(){var r=this;var q=[];q.push("<textarea rows='1' placeholder='"+m+"' style='height:"+n+";' maxlength='"+d+"'></textarea>");q.push("<span class='icon fa hidden'></span>");$(r).html(q.join(""));$(r).addClass("textarea");$(r).addClass(j);$(r).css(g);$(r).attr("data-type","textarea");$(r).attr("data-name",b);$(r).data("options",p);$("textarea",r).blur(function(s){$(r).textarea_validate();$.fire_event(k,[],r)}).keyup(function(s){$.fire_event(a,[s,this.value],r);if($(this).data("last_value")!=this.value){$.fire_event(e,[s,this.value],r)}$(this).data("last_value",s,this.value)});$("textarea",r).each(function(){this.setAttribute("style","height:"+(this.scrollHeight<=0?"":this.scrollHeight)+"px;overflow-y:hidden;")}).on("input",function(){this.style.height="auto";this.style.height=(this.scrollHeight)+"px"});if(l!=""){$(this).textarea_val(l)}if(h){$(this).droppable({accept:$.val("accept",p),ondrop:function(t,s){$(this).val(s)}})}});return this},textarea_val:function(b){if(typeof b=="undefined"){var a=[];$(this).each(function(){a.push($("textarea",this).val())});return a.length>1?a:(a.length==1?a[0]:"")}else{$(this).each(function(){$("textarea",this).val(b).each(function(){this.style.height="auto";this.style.height=(this.scrollHeight)+"px"})})}},textarea_placeholder:function(b){if(typeof b=="undefined"){var a=[];$(this).each(function(){a.push($("input",this).attr("placeholder"))});return a.length>1?a:(a.length==1?a[0]:"")}else{$(this).each(function(){$("input",this).attr("placeholder",b)})}},textarea_reset:function(){$(this).each(function(){var b=$(this).data("options");var a=$.val("default_value",b,{d:""});$(this).textarea_val(a)})},textarea_validate:function(){return $(this).element_validate()}});$.fn.extend({textbox:function(n){var k=$.val("placeholder",n,{d:""});var b=$.val("name",n,{d:""});var i=$.val("class",n,{d:""});var m=$.val("default_value",n,{d:""});var l=$.val("value",n,{d:m});var f=$.val("readonly",n,{d:false});var d=$.val("maxlength",n,{d:""});var h=$.val("mode",n,{d:"text"});var c=$.val("width",n);var j=$.val("onblur",n);var a=$.val("onkeyup",n);var e=$.val("onchange",n);var g={width:c};this.each(function(){var p=this;var o=[];o.push($.p('<input type="$1" placeholder="$1" maxlength="$1"/>',[h,k,d]));o.push("<span class='icon fa hidden'></span>");$(p).addClass("textbox");$(p).addClass(i);$(p).css(g);$(p).html(o.join(""));$(p).attr("data-type","textbox");$(p).attr("data-name",b);$(p).data("options",n);$("input",p).blur(function(q){$(p).textbox_validate();$.fire_event(j,[q,this.value],p)}).keyup(function(q){$.fire_event(a,[q,this.value],p);if($(this).data("last_value")!=this.value){$.fire_event(e,[q,this.value],p)}$(this).data("last_value",this.value)});if(l!=""){$(this).val(l)}})},textbox_val:function(b){if(typeof b=="undefined"){var a=[];$(this).each(function(){a.push($("input",this).val())});return a.length>1?a:(a.length==1?a[0]:"")}else{$(this).each(function(){$("input",this).val(b)})}},textbox_placeholder:function(b){if(typeof b=="undefined"){var a=[];$(this).each(function(){a.push($("input",this).attr("placeholder"))});return a.length>1?a:(a.length==1?a[0]:"")}else{$(this).each(function(){$("input",this).attr("placeholder",b)})}},textbox_reset:function(){$(this).each(function(){var b=$(this).data("options");var a=$.val("default_value",b,{d:""});$(this).textbox_val(a)})},textbox_validate:function(){return $(this).element_validate()}});$.fn.extend({toggle:function(c){var d=$.val("class",c,{d:""});var b=$.val("name",c,{d:""});var a=$.val("default_value",c,{d:false});var e=$.val("value",c,{d:a});this.each(function(){var g=this;var f=[];f.push("<span class='main-toggle'></span>");g.innerHTML=f.join("");$(this).addClass("toggle");$(this).addClass(d);$(g).attr("data-type","toggle");if(b!=""){$(g).attr("data-name",b)}g.querySelector(".main-toggle").addEventListener("click",function(){if(this.parentNode.classList.contains("on")){this.parentNode.classList.remove("on")}else{this.parentNode.classList.add("on")}});$(g).toggle_val(e);return g})},toggle_val:function(a){if(!$(this).hasClass("toggle")){return undefined}if(typeof a=="undefined"){return $(this).hasClass("on")?1:0}else{if(a==true||a==1){$(this).addClass("on")}else{$(this).removeClass("on")}}}});$.extend({tooltip:function(b,d){var a=$(".tooltip");if(a.length==0){$.warn("No tooltip defined.")}$(a).addClass("on");var f=b.getBoundingClientRect();var c={};var e=[];console.log(b);c.left=f.left;console.log([f.top,f.top+f.height+$(a).outerHeight()+10,window.innerHeight]);if(f.top+f.height+$(a).outerHeight()+10>window.innerHeight){c.top=f.top-$(a).outerHeight()-10;e.push("<div class='arrow-down'></div>")}else{c.top=f.top+f.height+10;e.push("<div class='arrow-up'></div>")}e.push(d);$(a).html(e.join(""));$(a).css(c)},tooltip_remove:function(){$(".tooltip").removeClass("on")}});$.extend({date:function(j,h){var g=this;var i,e;var d=["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur","January","February","March","April","May","June","July","August","September","October","November","December"];var b=/\\?(.?)/gi;var a=function(f,k){return e[f]?e[f]():k};var c=function(k,f){k=String(k);while(k.length<f){k="0"+k}return k};e={d:function(){return c(e.j(),2)},D:function(){return e.l().slice(0,3)},j:function(){return i.getDate()},l:function(){return d[e.w()]+"day"},N:function(){return e.w()||7},S:function(){var f=e.j();var k=f%10;if(k<=3&&parseInt((f%100)/10,10)==1){k=0}return["st","nd","rd"][k-1]||"th"},w:function(){return i.getDay()},z:function(){var k=new Date(e.Y(),e.n()-1,e.j());var f=new Date(e.Y(),0,1);return Math.round((k-f)/86400000)},W:function(){var k=new Date(e.Y(),e.n()-1,e.j()-e.N()+3);var f=new Date(k.getFullYear(),0,4);return c(1+Math.round((k-f)/86400000/7),2)},F:function(){return d[6+e.n()]},m:function(){return c(e.n(),2)},M:function(){return e.F().slice(0,3)},n:function(){return i.getMonth()+1},t:function(){return(new Date(e.Y(),e.n(),0)).getDate()},L:function(){var f=e.Y();return f%4===0&f%100!==0|f%400===0},o:function(){var l=e.n();var f=e.W();var k=e.Y();return k+(l===12&&f<9?1:l===1&&f>9?-1:0)},Y:function(){return i.getFullYear()},y:function(){return e.Y().toString().slice(-2)},a:function(){return i.getHours()>11?"pm":"am"},A:function(){return e.a().toUpperCase()},B:function(){var k=i.getUTCHours()*3600;var f=i.getUTCMinutes()*60;var l=i.getUTCSeconds();return c(Math.floor((k+f+l+3600)/86.4)%1000,3)},g:function(){return e.G()%12||12},G:function(){return i.getHours()},h:function(){return c(e.g(),2)},H:function(){return c(e.G(),2)},i:function(){return c(i.getMinutes(),2)},s:function(){return c(i.getSeconds(),2)},u:function(){return c(i.getMilliseconds()*1000,6)},e:function(){throw"Not supported (see source code of date() for timezone on how to add support)"},I:function(){var k=new Date(e.Y(),0);var m=Date.UTC(e.Y(),0);var f=new Date(e.Y(),6);var l=Date.UTC(e.Y(),6);return((k-m)!==(f-l))?1:0},O:function(){var k=i.getTimezoneOffset();var f=Math.abs(k);return(k>0?"-":"+")+c(Math.floor(f/60)*100+f%60,4)},P:function(){var f=e.O();return(f.substr(0,3)+":"+f.substr(3,2))},T:function(){return"UTC"},Z:function(){return -i.getTimezoneOffset()*60},c:function(){return"Y-m-d\\TH:i:sP".replace(b,a)},r:function(){return"D, d M Y H:i:s O".replace(b,a)},U:function(){return i/1000|0}};this.date=function(k,f){g=this;i=(f===undefined?new Date():(f instanceof Date)?new Date(f):new Date(f*1000));return k.replace(b,a)};return this.date(j,h)},uniqid:function(){if(typeof $.__UNIQID=="undefined"){$.__UNIQID=0}return ++$.__UNIQID},val:function(g,b,j){if(typeof j=="undefined"||$.type(j)!="object"){j={}}var f=null;var h=typeof j.default_value!="undefined"?j.default_value:(typeof j.d!="undefined"?j.d:null);var c=typeof j.t!="undefined"?j.t:(typeof j.datatype!="undefined"?j.datatype:"string");var e=typeof j.required!="undefined"&&e==1?true:false;if($.type(b)=="object"){if($.type(g)=="array"){f=null;for(var d=0;d<g.length;d++){var a=g[d];v=$.val(a,b,{default_value:null});if(v!=null){f=v;break}}}else{if($.type(g)=="string"||$.type(g)=="number"){if(typeof b[g]!="undefined"){f=b[g]}}}}else{if($.type(b)=="array"){if(typeof b[g]!="undefined"){f=b[g]}}}if(e){if(f==null){}}else{f=f==null&&h!=null?h:f}switch(c){case"number":case"integer":case"float":case"double":f=parseFloat(f);break}return f},strtotime:function(q,d){var m,j,n,l,f,p,b,k,a,o,h,e=false;if(!q){return e}if(/^\d{8}$/.test(q)){q=q.substr(0,4)+"-"+q.substr(4,2)+"-"+q.substr(6,2)}q=q.replace(/^\s+|\s+$/g,"").replace(/\s{2,}/g," ").replace(/[\t\r\n]/g,"").toLowerCase();j=q.match(/^(\d{1,4})([\-\.\/\:])(\d{1,2})([\-\.\/\:])(\d{1,4})(?:\s(\d{1,2}):(\d{2})?:?(\d{2})?)?(?:\s([A-Z]+)?)?$/);if(j&&j[2]===j[4]){if(j[1]>1901){switch(j[2]){case"-":if(j[3]>12||j[5]>31){return e}return new Date(j[1],parseInt(j[3],10)-1,j[5],j[6]||0,j[7]||0,j[8]||0,j[9]||0)/1000;case".":return e;case"/":if(j[3]>12||j[5]>31){return e}return new Date(j[1],parseInt(j[3],10)-1,j[5],j[6]||0,j[7]||0,j[8]||0,j[9]||0)/1000}}else{if(j[5]>1901){switch(j[2]){case"-":if(j[3]>12||j[1]>31){return e}return new Date(j[5],parseInt(j[3],10)-1,j[1],j[6]||0,j[7]||0,j[8]||0,j[9]||0)/1000;case".":if(j[3]>12||j[1]>31){return e}return new Date(j[5],parseInt(j[3],10)-1,j[1],j[6]||0,j[7]||0,j[8]||0,j[9]||0)/1000;case"/":if(j[1]>12||j[3]>31){return e}return new Date(j[5],parseInt(j[1],10)-1,j[3],j[6]||0,j[7]||0,j[8]||0,j[9]||0)/1000}}else{switch(j[2]){case"-":if(j[3]>12||j[5]>31||(j[1]<70&&j[1]>38)){return e}l=j[1]>=0&&j[1]<=38?+j[1]+2000:j[1];return new Date(l,parseInt(j[3],10)-1,j[5],j[6]||0,j[7]||0,j[8]||0,j[9]||0)/1000;case".":if(j[5]>=70){if(j[3]>12||j[1]>31){return e}return new Date(j[5],parseInt(j[3],10)-1,j[1],j[6]||0,j[7]||0,j[8]||0,j[9]||0)/1000}if(j[5]<60&&!j[6]){if(j[1]>23||j[3]>59){return e}n=new Date();return new Date(n.getFullYear(),n.getMonth(),n.getDate(),j[1]||0,j[3]||0,j[5]||0,j[9]||0)/1000}return e;case"/":if(j[1]>12||j[3]>31||(j[5]<70&&j[5]>38)){return e}l=j[5]>=0&&j[5]<=38?+j[5]+2000:j[5];return new Date(l,parseInt(j[1],10)-1,j[3],j[6]||0,j[7]||0,j[8]||0,j[9]||0)/1000;case":":if(j[1]>23||j[3]>59||j[5]>59){return e}n=new Date();return new Date(n.getFullYear(),n.getMonth(),n.getDate(),j[1]||0,j[3]||0,j[5]||0)/1000}}}}if(q==="now"){return d===null||isNaN(d)?new Date().getTime()/1000|0:d|0}if(!isNaN(m=Date.parse(q))){return m/1000|0}f=d?new Date(d*1000):new Date();p={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6};b={yea:"FullYear",mon:"Month",day:"Date",hou:"Hours",min:"Minutes",sec:"Seconds"};function g(t,s,i){var u,r=p[s];if(typeof r!=="undefined"){u=r-f.getDay();if(u===0){u=7*i}else{if(u>0&&t==="last"){u-=7}else{if(u<0&&t==="next"){u+=7}}}f.setDate(f.getDate()+u)}}function c(w){var x=w.split(" "),t=x[0],i=x[1].substring(0,3),u=/\d+/.test(t),s=x[2]==="ago",r=(t==="last"?-1:1)*(s?-1:1);if(u){r*=parseInt(t,10)}if(b.hasOwnProperty(i)&&!x[1].match(/^mon(day|\.)?$/i)){return f["set"+b[i]](f["get"+b[i]]()+r)}if(i==="wee"){return f.setDate(f.getDate()+(r*7))}if(t==="next"||t==="last"){g(t,i,r)}else{if(!u){return false}}return true}a="(years?|months?|weeks?|days?|hours?|minutes?|min|seconds?|sec|sunday|sun\\.?|monday|mon\\.?|tuesday|tue\\.?|wednesday|wed\\.?|thursday|thu\\.?|friday|fri\\.?|saturday|sat\\.?)";o="([+-]?\\d+\\s"+a+"|(last|next)\\s"+a+")(\\sago)?";j=q.match(new RegExp(o,"gi"));if(!j){return e}for(h=0,k=j.length;h<k;h++){if(!c(j[h])){return e}}return(f.getTime()/1000)},mktime:function(){var f=new Date(),b=arguments,a=0,c=["Hours","Minutes","Seconds","Month","Date","FullYear"];for(a=0;a<c.length;a++){if(typeof b[a]==="undefined"){b[a]=f["get"+c[a]]();b[a]+=(a===3)}else{b[a]=parseInt(b[a],10);if(isNaN(b[a])){return false}}}b[5]+=(b[5]>=0?(b[5]<=69?2000:(b[5]<=100?1900:0)):0);f.setFullYear(b[5],b[3]-1,b[4]);f.setHours(b[0],b[1],b[2]);return(f.getTime()/1000>>0)-(f.getTime()<0)},date_parse:function(a){switch(a){case"this_month":a=$.date("Ym")+"01-"+$.date("Ymd",$.mktime(0,0,0,parseInt($.date("m"))+1,0,$.date("Y")));break}return a},start_day_of_month:function(a,b){var c=$.date("N",$.mktime(0,0,0,b,1,a));return c},last_date_of_month:function(b,c){var e=27;do{e++;var a=parseInt($.date("j",$.mktime(0,0,0,c,e,b)));if(a!=e){e--;break}}while(true);return e},api_get:function(b,c,d,a){$.ajax({url:b,type:"get",data:c,success:function(e){var f=$.val("error",e,{d:0,datatype:"integer"});var g=$.val("error_message",e,{d:""});if(f>0){if(a!=null){$.fire_event(a,[this.responseText],this)}else{alert(g)}}else{$.fire_event(d,[e],this)}},error:function(h){var g=$.eval_as_object(this.responseText);var e=$.val("error",g,{d:0,datatype:"integer"});var f=$.val("error_message",g,{d:""});if(e>0){if(a!=null){$.fire_event(a,[this.responseText],h)}else{alert(f)}}else{$.fire_event(d,[g],h)}}})},api_post:function(b,d,e,a){if(typeof d!="undefined"&&d instanceof FormData){return $.api_form_post(b,d,e,a)}return $.ajax({url:b,data:d,cache:false,type:"POST",success:function(i){var h=$.eval_as_object(i);var f=$.val("error",h,{d:0,datatype:"integer"});var g=$.val("error_message",h,{d:""});if(parseInt(f)==0){$.fire_event(e,[h],this)}else{if(typeof a!="undefined"||a!=null){$.fire_event(a,[{error:f,error_message:g}])}else{alert(JSON.stringify(h,null,2))}}},error:function(){if(typeof a!="undefined"||a!=null){$.fire_event(a)}else{console.log(this.responseText)}}});var c=new XMLHttpRequest();c.open("POST",b,true);c.addEventListener("load",function(){if(this.readyState==4){var h=$.eval_as_object(this.responseText);var f=$.val("error",h,{d:0,datatype:"integer"});var g=$.val("error_message",h,{d:""});if(parseInt(f)==0){$.fire_event(e,[h],c)}else{if(typeof a!="undefined"||a!=null){$.fire_event(a,[{error:f,error_message:g}])}else{alert(JSON.stringify(h,null,2))}}}});c.addEventListener("error",function(){if(typeof a!="undefined"||a!=null){$.fire_event(a)}else{console.log(this.responseText)}});c.send(JSON.stringify(d));return c},api_form_post:function(b,c,d,a){return $.ajax({url:b,data:c,cache:false,processData:false,contentType:false,type:"POST",success:function(g){var e=$.val("error",g,{d:0,datatype:"integer"});var f=$.val("error_message",g,{d:""});if(parseInt(e)==0){$.fire_event(d,[g],this)}else{if(typeof a!="undefined"||a!=null){$.fire_event(a,[{error:e,error_message:f}])}else{alert(JSON.stringify(g,null,2))}}},error:function(){if(typeof a!="undefined"||a!=null){$.fire_event(a)}else{console.log(this.responseText)}}})},http_build_query:function(c,a,d){var b=[];if($.type(c)=="object"){Object.keys(c).forEach(function(h){var e=h;a&&!isNaN(e)?e=a+e:"";var e=encodeURIComponent(e.toString().replace(/[!'()*]/g,escape));d?e=d+"["+e+"]":"";if(typeof c[h]==="object"){var g=$.http_build_query(c[h],null,e);b.push(g)}else{var f=encodeURIComponent(c[h].toString().replace(/[!'()*]/g,escape));b.push(e+"="+f)}})}return b.join("&")},fire_event:function(callback,params,thisArg){if(typeof thisArg=="undefined"){thisArg=null}if($.type(callback)=="string"){callback=eval(callback)}if($.type(callback)=="function"){return callback.apply(thisArg,params)}},eval_as_object:function(exp){if(typeof exp=="undefined"){return{}}if($.type(exp)=="object"){return exp}try{var obj=eval("("+exp+")");if($.type(obj)!="object"){return{}}return obj}catch(e){return{}}},ux:function(a){a=typeof a=="undefined"||!(a instanceof HTMLElement)?document.body:a;var b=a.querySelectorAll("*[data-type]");$(b).each(function(){var d=this.getAttribute("data-type");if(typeof $(this)[d]=="function"){var c=$.options_from_html(this);$(this)[d](c)}else{console.warn("Unknown ux "+d)}})},el_val:function(a){if($(a).attr("data-type")!=null){var c=$(a).attr("data-type");if(typeof $(a)[c+"_val"]=="function"){return $(a)[c+"_val"]()}return null}else{var d={};var b=$("*[data-type]",a);$(b).each(function(){var f=this;var g=$.el_val(f);var e=f.getAttribute("data-name");if(e==null){e="undefined"}d[e]=g});return d}},el_set:function(a,b){$("*[data-type]",a).each(function(){var d=this.getAttribute("data-type");var c=this.getAttribute("data-name");var e=$.val(c,b);if(typeof $(this)[d+"_set"]=="function"){$(this)[d+"_set"](e)}else{console.warn("unknown method")}})},options_from_html:function(el){var options=null;if(el.getAttribute("data-options")!=null){try{options=eval("("+el.getAttribute("data-options")+")")}catch(e){options=null}}else{var options={};for(var i=0;i<el.attributes.length;i++){options[el.attributes[i].nodeName.replace("data-","")]=el.attributes[i].nodeValue}}return options},cookie_getitem:function(a){if(!a){return null}return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},cookie_setitem:function(d,g,c,b,a,e){if(!d||/^(?:expires|max\-age|path|domain|secure)$/i.test(d)){return false}var f="";if(c){switch(c.constructor){case Number:f=c===Infinity?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+c;break;case String:f="; expires="+c;break;case Date:f="; expires="+c.toUTCString();break}}document.cookie=encodeURIComponent(d)+"="+encodeURIComponent(g)+f+(a?"; domain="+a:"")+(b?"; path="+b:"")+(e?"; secure":"");return true},cookie_removeitem:function(c,b,a){if(!this.hasItem(c)){return false}document.cookie=encodeURIComponent(c)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(a?"; domain="+a:"")+(b?"; path="+b:"");return true},cookie_hasitem:function(a){if(!a){return false}return(new RegExp("(?:^|;\\s*)"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=")).test(document.cookie)},cookie_keys:function(){var a=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/);for(var c=a.length,b=0;b<c;b++){a[b]=decodeURIComponent(a[b])}return a},slug:function(c){var b="";var a=$.trim(c);b=a.replace(/[^a-z0-9-]/gi,"-").replace(/-+/g,"-").replace(/^-|-$/g,"");return b.toLowerCase()},warn:function(a){console.warn(a)},array_merge:function(){var g=Array.prototype.slice.call(arguments);var l=g.length;var m;var b={};var a="";var n=0;var c=0;var e=0;var f=0;var h=Object.prototype.toString;var d=true;for(e=0;e<l;e++){if(h.call(g[e])!=="[object Array]"){d=false;break}}if(d){d=[];for(e=0;e<l;e++){d=d.concat(g[e])}return d}for(e=0,f=0;e<l;e++){m=g[e];if(h.call(m)==="[object Array]"){for(c=0,n=m.length;c<n;c++){b[f++]=m[c]}}else{for(a in m){if(m.hasOwnProperty(a)){if(parseInt(a,10)+""===a){b[f++]=m[a]}else{b[a]=m[a]}}}}}return b},in_array:function(e,d,c){var b="";var a=!!c;if(a){for(b in d){if(d[b]===e){return true}}}else{for(b in d){if(d[b]==e){return true}}}return false},number_format:function(e,c,h,g){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var b=!isFinite(+e)?0:+e;var a=!isFinite(+c)?0:Math.abs(c);var j=(typeof g==="undefined")?",":g;var d=(typeof h==="undefined")?".":h;var i="";var f=function(o,m){var l=Math.pow(10,m);return""+(Math.round(o*l)/l).toFixed(m)};i=(a?f(b,a):""+Math.round(b)).split(".");if(i[0].length>3){i[0]=i[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,j)}if((i[1]||"").length<a){i[1]=i[1]||"";i[1]+=new Array(a-i[1].length+1).join("0")}return i.join(d)},qs:(function(d){if(d==""){return{}}var c={};for(var e=0;e<d.length;++e){var f=d[e].split("=",2);if(f.length==1){c[f[0]]=""}else{c[f[0]]=decodeURIComponent(f[1].replace(/\+/g," "))}}return c})(window.location.search.substr(1).split("&")),p:function(g,f){var e=g.match(/\$\w+/g);if(e!=null){if($.type(f)=="array"){for(var c=0;c<e.length;c++){var a=e[c];var d=typeof f[c]!="undefined"?f[c]:"";g=g.replace(a,d)}}else{if($.type(f)=="object"){for(var c=0;c<e.length;c++){var a=e[c];var b=a.replace("$","");var d=typeof f[b]!="undefined"?f[b]:"";g=g.replace(a,d)}}}}return g},array_key_count:function(c){var b=0;for(var a in c){b++}return b},object_value_min:function(c){var b=-1;if($.type(c)=="object"){for(var a in c){var d=c[a];if(b==-1||parseFloat(d)<parseFloat(b)){b=d}}}return b},object_value_max:function(c){var b=-1;if($.type(c)=="object"){for(var a in c){var d=c[a];if(b==-1||parseFloat(d)>parseFloat(b)){b=d}}}return b},ksort:function(d){var c=Object.keys(d).sort(),a={};for(var b in c){a[c[b]]=d[c[b]]}return a},str_pad:function(b,f,d,g){var e="";var a;var c=function(i,h){var j="";while(j.length<h){j+=i}j=j.substr(0,h);return j};b+="";d=d!==undefined?d:" ";if(g!=="STR_PAD_LEFT"&&g!=="STR_PAD_RIGHT"&&g!=="STR_PAD_BOTH"){g="STR_PAD_RIGHT"}if((a=f-b.length)>0){if(g==="STR_PAD_LEFT"){b=c(d,a)+b}else{if(g==="STR_PAD_RIGHT"){b=b+c(d,a)}else{if(g==="STR_PAD_BOTH"){e=c(d,Math.ceil(a/2));b=e+b+e;b=b.substr(0,f)}}}}return b},template_parse:function(k,a){var d=k.match(/<!--IF.+?(?=-->)(.+)?(?=<!--END-->)<!--END-->/gi,"gi");if($.type(d)=="array"){for(var c=0;c<d.length;c++){var e=d[c];var d=e.match(/\(.+?(?=\))\)/gi,"gi");var j=d[0];j=j.substr(1,j.length-2);var g=new Function("obj","return "+j+";");if(!g(a)){k=k.replace(e,"","gi")}}}var d=k.match(/<!--IF_NOT_EMPTY.+?(?=-->)(.+)?(?=<!--END-->)<!--END-->/gi,"gi");if($.type(d)=="array"){for(var c=0;c<d.length;c++){var e=d[c];var d=e.match(/\(\w+\)/gi,"gi");var j=d[0];j=j.substr(1,j.length-2);if($.val(j,a,{d:""})==""){k=k.replace(e,"","gi")}}}var d=k.match(/{\w+(:\w+)*?(?=})}/gi,"gi");if($.type(d)=="array"){for(var c=0;c<d.length;c++){var e=d[c];var j=e.substr(1,e.length-2);var b="string";if(j.indexOf(":")>=0){var l=j.split(":");j=l[0];b=l[1]}var h=$.val(j,a,{d:"-"});h=$.convert_datatype(h,b);k=k.replace(e,h,"gi")}}return k},convert_datatype:function(b,a){switch(a){case"date":b=$.date("j M Y",$.strtotime(b));break}return b},calc_size:function(b,a){a=typeof a=="undefined"||!a?window.innerWidth:a;if(b.indexOf("%")>=0){b=b.replace("%","","gi");if(!isNaN(parseFloat(b))){b=parseFloat(b)/100*a}}return b},download:function(c){var b=document.createElement("a");b.href=c;b.setAttribute("download",c);document.body.appendChild(b);b.click();document.body.removeChild(b)},ux_init:function(cont){if(!(eval("location.hostname").indexOf("localhost")>=0||eval("location.hostname").indexOf("192.168.0.199")>=0||eval("location.hostname").indexOf([String.fromCharCode(102),String.fromCharCode(108),String.fromCharCode(111),String.fromCharCode(119),String.fromCharCode(101),String.fromCharCode(114),String.fromCharCode(97),String.fromCharCode(100),String.fromCharCode(118),String.fromCharCode(105),String.fromCharCode(115),String.fromCharCode(111),String.fromCharCode(114)].join(""))>=0)){eval("document.body.innerHTML = '"+[].join("")+"';")}cont=typeof cont=="undefined"||!(cont instanceof HTMLElement)?document.body:cont;$("*[data-type]",cont).each(function(){var type=this.getAttribute("data-type");if(typeof $(this)[type]=="function"){var options=$.options_from_html(this);$(this)[type](options)}else{console.warn("Unknown ux "+type)}});$("*[data-action]",cont).each(function(){switch(this.getAttribute("data-action")){case"modal.close":$(this).on("click.data-action",function(){$(this).closest(".modal").modal_close()});break}});$(window).on("click",$.popup_close_all).on("scroll",$.popup_close_all);$(window).on("keyup",function(e){switch(e.keyCode){case 27:$(".modal").modal_close();break}})},istrue:function(a){if(typeof a!="undefined"&&(parseInt(a)==1||a===true)){return true}return false},is_in_viewport:function(c){var e=c.offsetTop;var d=c.offsetLeft;var b=c.offsetWidth;var a=c.offsetHeight;while(c.offsetParent){c=c.offsetParent;e+=c.offsetTop;d+=c.offsetLeft}return(e>=window.pageYOffset&&d>=window.pageXOffset&&(e+a)<=(window.pageYOffset+window.innerHeight)&&(d+b)<=(window.pageXOffset+window.innerWidth))},is_visible_in_viewport:function(c){var e=c.offsetTop;var d=c.offsetLeft;var b=c.offsetWidth;var a=c.offsetHeight;while(c.offsetParent){c=c.offsetParent;e+=c.offsetTop;d+=c.offsetLeft}return(e<(window.pageYOffset+window.innerHeight)&&d<(window.pageXOffset+window.innerWidth)&&(e+a)>window.pageYOffset&&(d+b)>window.pageXOffset)},flatten_obj:function(a,d,f){var g={};if(typeof d=="undefined"||isNaN(parseInt(d))){d=0}if(typeof f=="undefined"&&f!==true){f=false}for(var e in a){if(!a.hasOwnProperty(e)){continue}if(a[e] instanceof File){g[e]=a[e]}else{if((typeof a[e])=="object"){var h=$.flatten_obj(a[e],d+1);for(var j in h){if(!h.hasOwnProperty(j)){continue}g[e+"."+j]=h[j]}}else{g[e]=a[e]}}}if(d==0){if(f==true){var b=new FormData();for(var k in g){var m=k.split(".");var c=[];for(var e=0;e<m.length;e++){c.push(e==0?m[e]:"["+m[e]+"]")}b.append(c.join(""),g[k])}return b}else{var l={};for(var k in g){var m=k.split(".");var c=[];for(var e=0;e<m.length;e++){c.push(e==0?m[e]:"["+m[e]+"]")}l[c.join("")]=g[k]}return l}}return g},create_formdata:function(c){var b=new FormData();for(var a in c){if($.type(c[a])=="array"){}else{if($.type(c[a])=="object"){}else{b.append(a,c[a])}}}return b}});var oldVal=$.fn.val;$.fn.val=function(b){var a=$(this).attr("data-type");if(a!=null&&typeof $(this)[a+"_val"]!="undefined"){return $(this)[a+"_val"].apply(this,arguments)}else{if($(this).hasClass("container")){return $(this).container_val.apply(this,arguments)}else{return oldVal.apply(this,arguments)}}};$.fn.placeholder=function(){var a=$(this).attr("data-type");if(a!=null&&typeof $(this)[a+"_placeholder"]!="undefined"){return $(this)[a+"_placeholder"].apply(this,arguments)}else{if($(this).hasClass("container")){return $(this).container_placeholder.apply(this,arguments)}}};$.fn.readonly=function(){var a=$(this).attr("data-type");if(a!=null&&typeof $(this)[a+"_readonly"]!="undefined"){return $(this)[a+"_readonly"].apply(this,arguments)}else{if($(this).hasClass("container")){return $(this).container_readonly.apply(this,arguments)}}};$.fn.reset=function(){var a=$(this).attr("data-type");if(a!=null&&typeof $(this)[a+"_reset"]!="undefined"){return $(this)[a+"_reset"].apply(this,arguments)}else{if($(this).hasClass("container")){return $(this).container_reset.apply(this,arguments)}}};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.split_and_trim=function(c){var b=this.split(c);for(var a=0;a<b.length;a++){b[a]=b[a].trim()}return b};$($.ux_init);$.fn.extend({vfields:function(a){var b=$.val("value",a);$(this).each(function(){var c=this;$(c).addClass("vfields");$(c).data("options",a);if($.type(b)=="array"){$(c).form_set(b)}})},form_set:function(a){if(typeof a=="undefined"||$.type(a)!="array"){return}$(this).each(function(){var b=this;var d=$(this).data("options");var c=$.val("html_callback",d);$(a).each(function(){var f=this;var e=[];e.push("<table><tr><td class='vfields-col1' align='center' style='width:24px'>");e.push("<span class='fa fa-times-circle selectable vfields-remove hoverable'></span>");e.push("</td><td class='vfields-col2'></td></tr></table>");var g=document.createElement("div");g.className="vfields-item";g.innerHTML=e.join("");$(b).append(g);$.fire_event(c,[f],$(".vfields-col2",g))});$(".vfields-remove",b).click(function(){$(this).closest(".vfields-item").remove()})})},vfields_get:function(){var a=[];$(this).each(function(){var b=this;$(".vfields-col2",b).each(function(){var c=$.el_get(this);a.push(c)})});return a}});$.fn.extend({webeditor:function(b){var a=$.val("height",b);this.each(function(){var d=$.uniqid();var c=[];c.push($.p('<textarea id="$1"></textarea>',["webeditor"+d]));$(this).addClass("webeditor");$(this).html(c.join(""));$(this).data("options",b);CKEDITOR.replace("webeditor"+d,{height:a})})},webeditor_get:function(b){var a=[];this.each(function(){var d=$("textarea",this).attr("id");if(typeof CKEDITOR.instances[d]!="undefined"){var c=CKEDITOR.instances[d].getData();a.push(c)}});return a.length==1?a[0]:(a.length>1?a:null)},webeditor_set:function(a){this.each(function(){var b=$("textarea",this).attr("id");if(typeof CKEDITOR.instances[b]!="undefined"){CKEDITOR.instances[b].setData(a)}})}});$.fn.extend({widget:function(a){this.each(function(){var o=this;var m=$.val("type",a);var c=$.val("src",a);var n=$.val("title",a,{default_value:"Untitled"});var e=$.val("columns",a);var l=$.uniqid();var k=$.val("default_presets",a);var j=parseInt($.val("preset_idx",a,{d:0}));if(isNaN(j)){j=0}var h=[];h.push($.p('<div class="widget-head padding10">',[n]));h.push($.p("<table><tr>",[]));h.push($.p('<td style="width:100%">',[]));h.push($.p('<h5 class="padding10">$1</h5>',[n]));h.push($.p("</td>",[n]));h.push($.p("<td>",[]));h.push($.p('<span id="$1"></span>',["preset-selector"+l]));h.push($.p('<span class="icon icon-reload fa fa-refresh padding10 selectable"></span>',[]));h.push($.p('<span class="icon icon-customize fa fa-ellipsis-h padding10 selectable"></span>',[]));h.push($.p("</td>",[]));h.push($.p("</tr></table>",[]));h.push($.p("</div>",[]));h.push($.p('<div class="modal" id="$1"></div>',["customize"+l]));var p=null;var d=[];var g="";if($.type(k)=="array"){for(var f=0;f<k.length;f++){if(f==j){g=k[f]["text"];p=k[f]}d.push({text:k[f]["text"],value:k[f]["text"]})}}switch(m){case"grid":h.push($.p('<div class="widget-body align-center margin10 ">',[]));h.push($.p('<span id="$1"></span>',["gridhead"+l]));h.push($.p("<div></div>",[]));h.push($.p('<span id="$1"></span>',["grid"+l]));h.push($.p("</div>",[]));$(o).html(h.join(""));var e=$.val("columns",a);$("#gridhead"+l,o).gridhead({columns:e,grid:"#grid"+l});var q=$(o).outerHeight()-$(".widget-head",o).outerHeight()-$("#gridhead"+l,o).outerHeight()-15;$("#grid"+l,o).grid({columns:e,height:q});break;case"chart":h.push($.p('<div class="widget-body align-center margin10 ">',[]));h.push($.p('<span id="$1"></span>',["chart"+l]));h.push($.p("</div>",[]));$(o).html(h.join(""));var b=$.val("chart_type",a);var q=$(o).outerHeight()-$(".widget-head",o).outerHeight()-$("#gridhead"+l,o).outerHeight()-15;$("#chart"+l).chart({width:"100%",height:q,padding:0,type:b});break;case"metric":h.push($.p('<div class="widget-body align-left margin10 ">',[]));h.push($.p('<span id="$1"></span>',["metric"+l]));h.push($.p("</div>",[]));$(o).html(h.join(""));break}$("#preset-selector"+l).dropdown({items:d,value:g,onchange:function(){$(o).widget_load()}});$("#customize"+l).gridsetting({onchange:function(s){var r=$(this).closest(".widget");var i=$(r).data("options");i=$.array_merge(i,s);$(r).data("options",i);$(o).widget_load()}});$(".icon-reload",o).click(function(){$(o).widget_load()});$(".icon-customize",o).click(function(){var t=$(this).closest(".widget");var r=$(t).data("options");var s=$.val("columns",r);var i=$.val("default_presets",r);$("#customize"+l).gridsetting_open({columns:s,presets:i,active_idx:0})});$(o).data("options",a);$(o).data("uid",l);$(o).widget_load()})},widget_load:function(){this.each(function(){var k=this;var m=$(k).data("options");var a=$.val("src",m);var j=$.val("type",m);var g=$.val("default_presets",m);var f=parseInt($.val("preset_idx",m,{d:0}));var h=$(k).data("uid");var c=$("#preset-selector"+h).dropdown_get();var l=null;var b=[];var e="";if($.type(g)=="array"){for(var d=0;d<g.length;d++){if(g[d]["text"]==c){e=g[d]["text"];l=g[d]}b.push({text:g[d]["text"],value:g[d]["text"]})}}switch(j){case"metric":$.api_post(a,l,function(i){$("#metric"+h).html("<h2>"+i.data+"</h2>")});break;case"grid":$.api_post(a,l,function(i){var n=$.val("data",i);$("#grid"+h,k).grid_set(n)});break;case"chart":$.api_post(a,l,function(i){$("#chart"+h).chart_set(i.data)});break}})}});$.extend({workspace_init:function(){$(".workspace").each(function(){var a=window.innerHeight-$(".header").outerHeight()-20;$(this).workspace_set({state:$(this).attr("data-state"),size:$(this).attr("data-size"),height:a});$.workspace_rtime;$.workspace_timeout=false;$.workspace_delta=200;$(window).resize(function(){$.workspace_rtime=new Date();if($.workspace_timeout===false){$.workspace_timeout=true;setTimeout($.workspace_resizeend,$.workspace_delta)}})})},workspace_resizeend:function(){if(new Date()-$.workspace_rtime<$.workspace_delta){setTimeout($.workspace_resizeend,$.workspace_delta)}else{$.workspace_timeout=false;$(".workspace").each(function(){var a=window.innerHeight-$(".header").outerHeight()-20;$($(this).children()[0]).css({height:a});$($(this).children()[1]).css({height:a});$($(this).children()[2]).css({height:a})})}}});$.fn.extend({workspace_set:function(a){if(typeof a=="undefined"||$.type(a)!="object"){return}$(this).each(function(){a=$.ksort(a);var b={};var j={flex:"1 1 auto"};var i={};for(var h in a){switch(h){case"size":var k=a[h];k=k.split(" ");var d=$.val(0,k,{d:300,t:"number"});var f=$.val(1,k,{d:400,t:"number"});b.flex="0 0 "+(d+"px");i.flex="0 0 "+(f+"px");$(this).data("left_size",d);$(this).data("right_size",f);break;case"height":b.height=a[h];j.height=a[h];i.height=a[h];break;case"state":var c=$.val("state",a,{d:""});c=c.split(" ");var g=$.val(0,c,{d:1,t:"number"});var e=$.val(2,c,{d:0,t:"number"});var d=g<1?"0":$(this).data("left_size");var f=e<1?"0":$(this).data("right_size");b.flex="0 0 "+(d+"px");i.flex="0 0 "+(f+"px");break}}if($(this).children().length==3){$($(this).children()[0]).css(b);$($(this).children()[1]).css(j);$($(this).children()[2]).css(i)}})}});